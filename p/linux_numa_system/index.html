<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Â∞çÊñºÂ§ßÂ§öÊï∏Á≥ªÁµ±ÔºåË®òÊÜ∂È´î‰πãÈñìÊ≤íÊúâ‰ªÄÈ∫ºÂ∑ÆÂà•ÔºåÊØèÂÄãË®òÊÜ∂È´îÂàÜÈ†ÅÈÉΩÂíåÂÖ∂‰ªñÂàÜÈ†Å‰∏ÄÊ®£Â•ΩÔºå‰ΩÜÊòØÂú® NUMA Á≥ªÁµ±‰∏≠ÔºåË®òÊÜ∂È´îÂíåÁõÆÂâçÊ≠£Âú®Âü∑Ë°åÁöÑ process ‰πãÈñìÁöÑË∑ùÈõ¢ÊòØÈúÄË¶ÅËÄÉÊÖÆÁöÑÔºåÂ¶ÇÊûú‰∏ÄÂÄã process ‰∏çÊñ∑ÁöÑÂ≠òÂèñÈÅ†Á´ØÁØÄÈªû‰∏äÁöÑÈ†ÅÈù¢ÔºåÂâáÂæàÊúâÂèØËÉΩÂ∞éËá¥ÊïàËÉΩÂ§ßÂπÖ‰∏ãÈôç„ÄÇÂ∞çÊñº NUMA Á≥ªÁµ±ÈúÄË¶ÅÁâπÂà•ËÄÉÊÖÆÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂõ†ÁÇ∫‰ªñÂÖ∑ÊúâÊúÄÂ∞èÂª∂ÈÅ≤‰ª•ÂèäÊúÄ‰Ω≥È†ªÂØ¨ÁöÑÁâπÊÄß„ÄÇ\nkernel ÊúâÂÄãÂæàÈáçË¶ÅÁöÑ‰ªªÂãô‰æøÊòØÁÇ∫ process ÂàÜÈÖçË®òÊÜ∂È´îÔºå‰ΩøÂæóË©≤ process ËÉΩÂ§†‰ª•ÊúÄÈ´òÊïàËÉΩÂü∑Ë°åÔºåÊ≠§Â§ñÔºåkernel ÊúâË®±Â§öÊ©üÂà∂ÂèØ‰ª•Áî®‰æÜÁ¢∫Ë™çÁØÄÈªûÁöÑ‰ΩçÁΩÆÔºåÁõÆÁöÑÊòØÁÇ∫‰∫ÜÁ¢∫‰øù‰ª•ÊúÄÂ∞èÂåñ NUMA Ë∑ùÈõ¢ÁöÑÊñπÂºèÂàÜÈÖçË®òÊÜ∂È´îÔºåÂú®Âü∑Ë°å process ÊúüÈñìÔºålocality ÂèØËÉΩÊúÉÂèóÂà∞Ë®±Â§öÂõ†Á¥†ÂΩ±ÈüøÔºåÂ¶Ç scheduler, memory allocation Á≠âÁ≠âÔºåÂõ†Ê≠§ kernel ÈúÄË¶ÅËÉΩÂ§†Âú® process Âü∑Ë°åÊôÇÁßªÂãïË®òÊÜ∂È´îÈ†ÅÈù¢ÔºåÈÄôÁ®±ÁÇ∫ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]\nÈóúÊñºË®òÊÜ∂È´îÂàÜÈÖç‰πüÂèØ‰ª•ÈÄöÈÅé process Êú¨Ë∫´Âª∫Á´ãË®òÊÜ∂È´îÁöÑÁ≠ñÁï•ÈÄ≤Ë°åÊéßÂà∂Ôºå‰æãÂ¶Ç process ÂèØ‰ª•Áü•ÈÅì‰ΩøÁî®ÁöÑË®òÊÜ∂È´î‰ΩçÊñºÂì™‰∏ÄÂÄãÁØÄÈªûÁ≠âÁ≠â„ÄÇ\n[[NUMA]] NUMA ÁÇ∫Èùû‰∏ÄËá¥ÊÄßË®òÊÜ∂È´îÂ≠òÂèñÔºåÈö®ËëóËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†ÔºåNUMA ÊäÄË°ìË∂ä‰æÜË∂äÈáçË¶ÅÔºåÂõ†ÁÇ∫ËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†Â∞çÊñºÊßãÂª∫ UMA Á≥ªÁµ±ÊúÉËÆäÂæóË∂ä‰æÜË∂äÂõ∞Èõ£ÔºåNUMA Á≥ªÁµ±Ëàá‰∏ÄËà¨ÂÖ∑ÊúâÂ§öËôïÁêÜÂô®ÁöÑÂ∏∏Ë¶èÁ≥ªÁµ±Â∑ÆÂà•Âú®Êñº‰∏Ä‰∫õË®òÊÜ∂È´îÊòØÂ±¨ÊñºËôïÁêÜÂô®ÁöÑÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂèØ‰ª•ÊúâÊúÄÂ∞èÁöÑÂª∂ÈÅ≤ÊôÇÈñìÂíåÊúÄÈ´ò throughputÔºåËÄåÂÖ∂‰ªñË®òÊÜ∂È´îÂ±¨ÊñºÈÅ†Á´ØÁöÑÔºåÊÄßËÉΩ‰∏ä‰∏çÂ¶ÇÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂª∂ÈÅ≤Êõ¥Â§ßÔºåÊõ¥Â∞èÁöÑ throughput„ÄÇ\n‰∏ãÈù¢Â∞áÊúÉ‰ªãÁ¥πÂú®Ê≤íÊúâ NUMA ÊÉÖÊ≥Å‰∏ãË®òÊÜ∂È´îÁÆ°ÁêÜÊòØÂ¶Ç‰ΩïÈÅã‰ΩúÁöÑÔºåÁÑ∂ËÄåÁúãÂà∞Ë®òÊÜ∂È´îÁÆ°ÁêÜÊ©üÂà∂Âú®ËÄÉÊÖÆ NUMA ÁöÑÊÉÖÊ≥ÅÂÅöÂá∫‰∫ÜÂì™‰∏Ä‰∫õË™øÊï¥ÔºåÊé•ËëóÊòØÈ´òÊïàÁéáÂàÜÈÖçË®òÊÜ∂È´îÊúÉÈÅáÂà∞ÁöÑÂïèÈ°åÔºåÁÑ∂ÂæåË®éË´ñÊú¨Âú∞Ë®òÊÜ∂È´îÂõûÊî∂‰ª•ÂèäË®òÊÜ∂È´îÈÅ∑ÁßªÁöÑÂïèÈ°å„ÄÇ\nÊúÄÂæåÁúãÂà∞ Linux process Â¶Ç‰ΩïÊâãÂãïÊéßÂà∂ NUMA Á≥ªÁµ±‰∏≠Ë®òÊÜ∂È´îÂàÜÈÖçÔºå‰ΩøÁî®ÁöÑÊñπÊ≥ïÈ¶ñÂÖàÊòØ memory policiesÔºå‰ª•Âèä cpusets„ÄÇ\nExample of NUMA system Â∞çÊñº SMP (Symmetric Multi-Processor) ‰ª•Âèä UP (Single Processor) Á≥ªÁµ±‰æÜË™™ÔºåË®òÊÜ∂È´îÊòØÁµ±‰∏ÄÁöÑÔºå‰πüÂ∞±ÊòØÂ≠òÂèñÊâÄÊúâË®òÊÜ∂È´îÊúâÁõ∏ÂêåÁöÑÊàêÊú¨„ÄÇÂú® NUMA Á≥ªÁµ±‰∏≠ÊúÉÂõ†ÁÇ∫ NUMA Ë∑ùÈõ¢ËÄåÊúâÊâÄÂ∑ÆÁï∞ÔºåÂÑ™Âåñ NUMA Á≥ªÁµ±‰∏äÂü∑Ë°åÁöÑÊáâÁî®Á®ãÂºèÊú¨Ë≥™‰∏äÊàëÂÄëÂ∏åÊúõ‰ª•ÊúÄ‰Ω≥ÊïàËÉΩÁöÑÊîæÁΩÆÊáâÁî®Á®ãÂºè‰ΩøÁî®Âà∞ÁöÑË≥áÊñôÁµêÊßãÁ≠âÁ≠â„ÄÇ\n"><title>Linux_NUMA_System</title><link rel=canonical href=https://wuta0209.github.io/p/linux_numa_system/><link rel=stylesheet href=/scss/style.min.42217344d95b2e9acb3b1742221f20a0f48c9e795b4199208d577294e9b89e09.css><meta property='og:title' content="Linux_NUMA_System"><meta property='og:description' content="Â∞çÊñºÂ§ßÂ§öÊï∏Á≥ªÁµ±ÔºåË®òÊÜ∂È´î‰πãÈñìÊ≤íÊúâ‰ªÄÈ∫ºÂ∑ÆÂà•ÔºåÊØèÂÄãË®òÊÜ∂È´îÂàÜÈ†ÅÈÉΩÂíåÂÖ∂‰ªñÂàÜÈ†Å‰∏ÄÊ®£Â•ΩÔºå‰ΩÜÊòØÂú® NUMA Á≥ªÁµ±‰∏≠ÔºåË®òÊÜ∂È´îÂíåÁõÆÂâçÊ≠£Âú®Âü∑Ë°åÁöÑ process ‰πãÈñìÁöÑË∑ùÈõ¢ÊòØÈúÄË¶ÅËÄÉÊÖÆÁöÑÔºåÂ¶ÇÊûú‰∏ÄÂÄã process ‰∏çÊñ∑ÁöÑÂ≠òÂèñÈÅ†Á´ØÁØÄÈªû‰∏äÁöÑÈ†ÅÈù¢ÔºåÂâáÂæàÊúâÂèØËÉΩÂ∞éËá¥ÊïàËÉΩÂ§ßÂπÖ‰∏ãÈôç„ÄÇÂ∞çÊñº NUMA Á≥ªÁµ±ÈúÄË¶ÅÁâπÂà•ËÄÉÊÖÆÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂõ†ÁÇ∫‰ªñÂÖ∑ÊúâÊúÄÂ∞èÂª∂ÈÅ≤‰ª•ÂèäÊúÄ‰Ω≥È†ªÂØ¨ÁöÑÁâπÊÄß„ÄÇ\nkernel ÊúâÂÄãÂæàÈáçË¶ÅÁöÑ‰ªªÂãô‰æøÊòØÁÇ∫ process ÂàÜÈÖçË®òÊÜ∂È´îÔºå‰ΩøÂæóË©≤ process ËÉΩÂ§†‰ª•ÊúÄÈ´òÊïàËÉΩÂü∑Ë°åÔºåÊ≠§Â§ñÔºåkernel ÊúâË®±Â§öÊ©üÂà∂ÂèØ‰ª•Áî®‰æÜÁ¢∫Ë™çÁØÄÈªûÁöÑ‰ΩçÁΩÆÔºåÁõÆÁöÑÊòØÁÇ∫‰∫ÜÁ¢∫‰øù‰ª•ÊúÄÂ∞èÂåñ NUMA Ë∑ùÈõ¢ÁöÑÊñπÂºèÂàÜÈÖçË®òÊÜ∂È´îÔºåÂú®Âü∑Ë°å process ÊúüÈñìÔºålocality ÂèØËÉΩÊúÉÂèóÂà∞Ë®±Â§öÂõ†Á¥†ÂΩ±ÈüøÔºåÂ¶Ç scheduler, memory allocation Á≠âÁ≠âÔºåÂõ†Ê≠§ kernel ÈúÄË¶ÅËÉΩÂ§†Âú® process Âü∑Ë°åÊôÇÁßªÂãïË®òÊÜ∂È´îÈ†ÅÈù¢ÔºåÈÄôÁ®±ÁÇ∫ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]\nÈóúÊñºË®òÊÜ∂È´îÂàÜÈÖç‰πüÂèØ‰ª•ÈÄöÈÅé process Êú¨Ë∫´Âª∫Á´ãË®òÊÜ∂È´îÁöÑÁ≠ñÁï•ÈÄ≤Ë°åÊéßÂà∂Ôºå‰æãÂ¶Ç process ÂèØ‰ª•Áü•ÈÅì‰ΩøÁî®ÁöÑË®òÊÜ∂È´î‰ΩçÊñºÂì™‰∏ÄÂÄãÁØÄÈªûÁ≠âÁ≠â„ÄÇ\n[[NUMA]] NUMA ÁÇ∫Èùû‰∏ÄËá¥ÊÄßË®òÊÜ∂È´îÂ≠òÂèñÔºåÈö®ËëóËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†ÔºåNUMA ÊäÄË°ìË∂ä‰æÜË∂äÈáçË¶ÅÔºåÂõ†ÁÇ∫ËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†Â∞çÊñºÊßãÂª∫ UMA Á≥ªÁµ±ÊúÉËÆäÂæóË∂ä‰æÜË∂äÂõ∞Èõ£ÔºåNUMA Á≥ªÁµ±Ëàá‰∏ÄËà¨ÂÖ∑ÊúâÂ§öËôïÁêÜÂô®ÁöÑÂ∏∏Ë¶èÁ≥ªÁµ±Â∑ÆÂà•Âú®Êñº‰∏Ä‰∫õË®òÊÜ∂È´îÊòØÂ±¨ÊñºËôïÁêÜÂô®ÁöÑÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂèØ‰ª•ÊúâÊúÄÂ∞èÁöÑÂª∂ÈÅ≤ÊôÇÈñìÂíåÊúÄÈ´ò throughputÔºåËÄåÂÖ∂‰ªñË®òÊÜ∂È´îÂ±¨ÊñºÈÅ†Á´ØÁöÑÔºåÊÄßËÉΩ‰∏ä‰∏çÂ¶ÇÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂª∂ÈÅ≤Êõ¥Â§ßÔºåÊõ¥Â∞èÁöÑ throughput„ÄÇ\n‰∏ãÈù¢Â∞áÊúÉ‰ªãÁ¥πÂú®Ê≤íÊúâ NUMA ÊÉÖÊ≥Å‰∏ãË®òÊÜ∂È´îÁÆ°ÁêÜÊòØÂ¶Ç‰ΩïÈÅã‰ΩúÁöÑÔºåÁÑ∂ËÄåÁúãÂà∞Ë®òÊÜ∂È´îÁÆ°ÁêÜÊ©üÂà∂Âú®ËÄÉÊÖÆ NUMA ÁöÑÊÉÖÊ≥ÅÂÅöÂá∫‰∫ÜÂì™‰∏Ä‰∫õË™øÊï¥ÔºåÊé•ËëóÊòØÈ´òÊïàÁéáÂàÜÈÖçË®òÊÜ∂È´îÊúÉÈÅáÂà∞ÁöÑÂïèÈ°åÔºåÁÑ∂ÂæåË®éË´ñÊú¨Âú∞Ë®òÊÜ∂È´îÂõûÊî∂‰ª•ÂèäË®òÊÜ∂È´îÈÅ∑ÁßªÁöÑÂïèÈ°å„ÄÇ\nÊúÄÂæåÁúãÂà∞ Linux process Â¶Ç‰ΩïÊâãÂãïÊéßÂà∂ NUMA Á≥ªÁµ±‰∏≠Ë®òÊÜ∂È´îÂàÜÈÖçÔºå‰ΩøÁî®ÁöÑÊñπÊ≥ïÈ¶ñÂÖàÊòØ memory policiesÔºå‰ª•Âèä cpusets„ÄÇ\nExample of NUMA system Â∞çÊñº SMP (Symmetric Multi-Processor) ‰ª•Âèä UP (Single Processor) Á≥ªÁµ±‰æÜË™™ÔºåË®òÊÜ∂È´îÊòØÁµ±‰∏ÄÁöÑÔºå‰πüÂ∞±ÊòØÂ≠òÂèñÊâÄÊúâË®òÊÜ∂È´îÊúâÁõ∏ÂêåÁöÑÊàêÊú¨„ÄÇÂú® NUMA Á≥ªÁµ±‰∏≠ÊúÉÂõ†ÁÇ∫ NUMA Ë∑ùÈõ¢ËÄåÊúâÊâÄÂ∑ÆÁï∞ÔºåÂÑ™Âåñ NUMA Á≥ªÁµ±‰∏äÂü∑Ë°åÁöÑÊáâÁî®Á®ãÂºèÊú¨Ë≥™‰∏äÊàëÂÄëÂ∏åÊúõ‰ª•ÊúÄ‰Ω≥ÊïàËÉΩÁöÑÊîæÁΩÆÊáâÁî®Á®ãÂºè‰ΩøÁî®Âà∞ÁöÑË≥áÊñôÁµêÊßãÁ≠âÁ≠â„ÄÇ\n"><meta property='og:url' content='https://wuta0209.github.io/p/linux_numa_system/'><meta property='og:site_name' content='WuTa Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux Kernel'><meta property='article:tag' content='Linux Kernel MM'><meta property='article:tag' content='NUMA'><meta property='article:published_time' content='2025-10-02T10:52:22+08:00'><meta property='article:modified_time' content='2025-10-02T10:52:22+08:00'><meta name=twitter:title content="Linux_NUMA_System"><meta name=twitter:description content="Â∞çÊñºÂ§ßÂ§öÊï∏Á≥ªÁµ±ÔºåË®òÊÜ∂È´î‰πãÈñìÊ≤íÊúâ‰ªÄÈ∫ºÂ∑ÆÂà•ÔºåÊØèÂÄãË®òÊÜ∂È´îÂàÜÈ†ÅÈÉΩÂíåÂÖ∂‰ªñÂàÜÈ†Å‰∏ÄÊ®£Â•ΩÔºå‰ΩÜÊòØÂú® NUMA Á≥ªÁµ±‰∏≠ÔºåË®òÊÜ∂È´îÂíåÁõÆÂâçÊ≠£Âú®Âü∑Ë°åÁöÑ process ‰πãÈñìÁöÑË∑ùÈõ¢ÊòØÈúÄË¶ÅËÄÉÊÖÆÁöÑÔºåÂ¶ÇÊûú‰∏ÄÂÄã process ‰∏çÊñ∑ÁöÑÂ≠òÂèñÈÅ†Á´ØÁØÄÈªû‰∏äÁöÑÈ†ÅÈù¢ÔºåÂâáÂæàÊúâÂèØËÉΩÂ∞éËá¥ÊïàËÉΩÂ§ßÂπÖ‰∏ãÈôç„ÄÇÂ∞çÊñº NUMA Á≥ªÁµ±ÈúÄË¶ÅÁâπÂà•ËÄÉÊÖÆÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂõ†ÁÇ∫‰ªñÂÖ∑ÊúâÊúÄÂ∞èÂª∂ÈÅ≤‰ª•ÂèäÊúÄ‰Ω≥È†ªÂØ¨ÁöÑÁâπÊÄß„ÄÇ\nkernel ÊúâÂÄãÂæàÈáçË¶ÅÁöÑ‰ªªÂãô‰æøÊòØÁÇ∫ process ÂàÜÈÖçË®òÊÜ∂È´îÔºå‰ΩøÂæóË©≤ process ËÉΩÂ§†‰ª•ÊúÄÈ´òÊïàËÉΩÂü∑Ë°åÔºåÊ≠§Â§ñÔºåkernel ÊúâË®±Â§öÊ©üÂà∂ÂèØ‰ª•Áî®‰æÜÁ¢∫Ë™çÁØÄÈªûÁöÑ‰ΩçÁΩÆÔºåÁõÆÁöÑÊòØÁÇ∫‰∫ÜÁ¢∫‰øù‰ª•ÊúÄÂ∞èÂåñ NUMA Ë∑ùÈõ¢ÁöÑÊñπÂºèÂàÜÈÖçË®òÊÜ∂È´îÔºåÂú®Âü∑Ë°å process ÊúüÈñìÔºålocality ÂèØËÉΩÊúÉÂèóÂà∞Ë®±Â§öÂõ†Á¥†ÂΩ±ÈüøÔºåÂ¶Ç scheduler, memory allocation Á≠âÁ≠âÔºåÂõ†Ê≠§ kernel ÈúÄË¶ÅËÉΩÂ§†Âú® process Âü∑Ë°åÊôÇÁßªÂãïË®òÊÜ∂È´îÈ†ÅÈù¢ÔºåÈÄôÁ®±ÁÇ∫ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]\nÈóúÊñºË®òÊÜ∂È´îÂàÜÈÖç‰πüÂèØ‰ª•ÈÄöÈÅé process Êú¨Ë∫´Âª∫Á´ãË®òÊÜ∂È´îÁöÑÁ≠ñÁï•ÈÄ≤Ë°åÊéßÂà∂Ôºå‰æãÂ¶Ç process ÂèØ‰ª•Áü•ÈÅì‰ΩøÁî®ÁöÑË®òÊÜ∂È´î‰ΩçÊñºÂì™‰∏ÄÂÄãÁØÄÈªûÁ≠âÁ≠â„ÄÇ\n[[NUMA]] NUMA ÁÇ∫Èùû‰∏ÄËá¥ÊÄßË®òÊÜ∂È´îÂ≠òÂèñÔºåÈö®ËëóËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†ÔºåNUMA ÊäÄË°ìË∂ä‰æÜË∂äÈáçË¶ÅÔºåÂõ†ÁÇ∫ËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†Â∞çÊñºÊßãÂª∫ UMA Á≥ªÁµ±ÊúÉËÆäÂæóË∂ä‰æÜË∂äÂõ∞Èõ£ÔºåNUMA Á≥ªÁµ±Ëàá‰∏ÄËà¨ÂÖ∑ÊúâÂ§öËôïÁêÜÂô®ÁöÑÂ∏∏Ë¶èÁ≥ªÁµ±Â∑ÆÂà•Âú®Êñº‰∏Ä‰∫õË®òÊÜ∂È´îÊòØÂ±¨ÊñºËôïÁêÜÂô®ÁöÑÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂèØ‰ª•ÊúâÊúÄÂ∞èÁöÑÂª∂ÈÅ≤ÊôÇÈñìÂíåÊúÄÈ´ò throughputÔºåËÄåÂÖ∂‰ªñË®òÊÜ∂È´îÂ±¨ÊñºÈÅ†Á´ØÁöÑÔºåÊÄßËÉΩ‰∏ä‰∏çÂ¶ÇÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂª∂ÈÅ≤Êõ¥Â§ßÔºåÊõ¥Â∞èÁöÑ throughput„ÄÇ\n‰∏ãÈù¢Â∞áÊúÉ‰ªãÁ¥πÂú®Ê≤íÊúâ NUMA ÊÉÖÊ≥Å‰∏ãË®òÊÜ∂È´îÁÆ°ÁêÜÊòØÂ¶Ç‰ΩïÈÅã‰ΩúÁöÑÔºåÁÑ∂ËÄåÁúãÂà∞Ë®òÊÜ∂È´îÁÆ°ÁêÜÊ©üÂà∂Âú®ËÄÉÊÖÆ NUMA ÁöÑÊÉÖÊ≥ÅÂÅöÂá∫‰∫ÜÂì™‰∏Ä‰∫õË™øÊï¥ÔºåÊé•ËëóÊòØÈ´òÊïàÁéáÂàÜÈÖçË®òÊÜ∂È´îÊúÉÈÅáÂà∞ÁöÑÂïèÈ°åÔºåÁÑ∂ÂæåË®éË´ñÊú¨Âú∞Ë®òÊÜ∂È´îÂõûÊî∂‰ª•ÂèäË®òÊÜ∂È´îÈÅ∑ÁßªÁöÑÂïèÈ°å„ÄÇ\nÊúÄÂæåÁúãÂà∞ Linux process Â¶Ç‰ΩïÊâãÂãïÊéßÂà∂ NUMA Á≥ªÁµ±‰∏≠Ë®òÊÜ∂È´îÂàÜÈÖçÔºå‰ΩøÁî®ÁöÑÊñπÊ≥ïÈ¶ñÂÖàÊòØ memory policiesÔºå‰ª•Âèä cpusets„ÄÇ\nExample of NUMA system Â∞çÊñº SMP (Symmetric Multi-Processor) ‰ª•Âèä UP (Single Processor) Á≥ªÁµ±‰æÜË™™ÔºåË®òÊÜ∂È´îÊòØÁµ±‰∏ÄÁöÑÔºå‰πüÂ∞±ÊòØÂ≠òÂèñÊâÄÊúâË®òÊÜ∂È´îÊúâÁõ∏ÂêåÁöÑÊàêÊú¨„ÄÇÂú® NUMA Á≥ªÁµ±‰∏≠ÊúÉÂõ†ÁÇ∫ NUMA Ë∑ùÈõ¢ËÄåÊúâÊâÄÂ∑ÆÁï∞ÔºåÂÑ™Âåñ NUMA Á≥ªÁµ±‰∏äÂü∑Ë°åÁöÑÊáâÁî®Á®ãÂºèÊú¨Ë≥™‰∏äÊàëÂÄëÂ∏åÊúõ‰ª•ÊúÄ‰Ω≥ÊïàËÉΩÁöÑÊîæÁΩÆÊáâÁî®Á®ãÂºè‰ΩøÁî®Âà∞ÁöÑË≥áÊñôÁµêÊßãÁ≠âÁ≠â„ÄÇ\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=ÂàáÊèõÈÅ∏ÂñÆ>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_1c6ae99766100603.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>WuTa Blog</a></h1><h2 class=site-description>The best learning is trying to teach.</h2></div></header><ol class=menu-social><li><a href=https://github.com/WuTa0209 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://ithelp.ithome.com.tw/users/20138181 target=_blank title=ITHome rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>AboutMe</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Â§úÊôöÊ®°Âºè</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ÁõÆÈåÑ</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#numa>[[NUMA]]</a></li><li><a href=#example-of-numa-system>Example of NUMA system</a></li><li><a href=#ÈóúÊñº-linux-mememory-management>ÈóúÊñº Linux Mememory Management</a></li><li><a href=#ÈóúÊñº-numa-Ë®òÊÜ∂È´î>ÈóúÊñº NUMA Ë®òÊÜ∂È´î</a></li><li><a href=#ÊúÄ‰Ω≥ÊáâÁî®-numa-ÁöÑÊáâÁî®Á®ãÂºèÁâπÂæµ>ÊúÄ‰Ω≥ÊáâÁî® NUMA ÁöÑÊáâÁî®Á®ãÂºèÁâπÂæµ</a></li><li><a href=#ÈóúÊñºÂ§öÁØÄÈªûÊáâÁî®Á®ãÂºè>ÈóúÊñºÂ§öÁØÄÈªûÊáâÁî®Á®ãÂºè</a></li><li><a href=#ÈóúÊñº-linux-‰∏≠-interleave-memory-memory-spreading>ÈóúÊñº Linux ‰∏≠ Interleave Memory, Memory Spreading</a></li><li><a href=#ÈóúÊñº-page-cache>ÈóúÊñº page cache</a></li><li><a href=#ÈóúÊñºË®òÊÜ∂È´îÂõûÊî∂>ÈóúÊñºË®òÊÜ∂È´îÂõûÊî∂</a></li><li><a href=#ÈóúÊñº-numa-ÁöÑË®òÊÜ∂È´îÂõûÊî∂>ÈóúÊñº NUMA ÁöÑË®òÊÜ∂È´îÂõûÊî∂</a></li><li><a href=#ÈóúÊñº-numa-interlink-ÁöÑÈôêÂà∂>ÈóúÊñº NUMA Interlink ÁöÑÈôêÂà∂</a></li><li><a href=#cpuset-ÊéßÂà∂-page-migration-È†ÅÈù¢ÈÅ∑Áßª>CPUset ÊéßÂà∂ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]</a></li><li><a href=#Êõ¥Â§öÈóúÊñº-cpuset>Êõ¥Â§öÈóúÊñº CPUset</a></li><li><a href=#ÈúÄË¶ÅÈù¢Ëá®ÁöÑÂïèÈ°å>ÈúÄË¶ÅÈù¢Ëá®ÁöÑÂïèÈ°å</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/linux-kernel/>Linux Kernel</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/linux_numa_system/>Linux_NUMA_System</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 02, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>Èñ±ËÆÄÊôÇÈñì: 6 ÂàÜÈêò</time></div></footer></div></header><section class=article-content><p>Â∞çÊñºÂ§ßÂ§öÊï∏Á≥ªÁµ±ÔºåË®òÊÜ∂È´î‰πãÈñìÊ≤íÊúâ‰ªÄÈ∫ºÂ∑ÆÂà•ÔºåÊØèÂÄãË®òÊÜ∂È´îÂàÜÈ†ÅÈÉΩÂíåÂÖ∂‰ªñÂàÜÈ†Å‰∏ÄÊ®£Â•ΩÔºå‰ΩÜÊòØÂú® NUMA Á≥ªÁµ±‰∏≠ÔºåË®òÊÜ∂È´îÂíåÁõÆÂâçÊ≠£Âú®Âü∑Ë°åÁöÑ process ‰πãÈñìÁöÑË∑ùÈõ¢ÊòØÈúÄË¶ÅËÄÉÊÖÆÁöÑÔºåÂ¶ÇÊûú‰∏ÄÂÄã process ‰∏çÊñ∑ÁöÑÂ≠òÂèñÈÅ†Á´ØÁØÄÈªû‰∏äÁöÑÈ†ÅÈù¢ÔºåÂâáÂæàÊúâÂèØËÉΩÂ∞éËá¥ÊïàËÉΩÂ§ßÂπÖ‰∏ãÈôç„ÄÇÂ∞çÊñº NUMA Á≥ªÁµ±ÈúÄË¶ÅÁâπÂà•ËÄÉÊÖÆÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂõ†ÁÇ∫‰ªñÂÖ∑ÊúâÊúÄÂ∞èÂª∂ÈÅ≤‰ª•ÂèäÊúÄ‰Ω≥È†ªÂØ¨ÁöÑÁâπÊÄß„ÄÇ</p><p>kernel ÊúâÂÄãÂæàÈáçË¶ÅÁöÑ‰ªªÂãô‰æøÊòØÁÇ∫ process ÂàÜÈÖçË®òÊÜ∂È´îÔºå‰ΩøÂæóË©≤ process ËÉΩÂ§†‰ª•ÊúÄÈ´òÊïàËÉΩÂü∑Ë°åÔºåÊ≠§Â§ñÔºåkernel ÊúâË®±Â§öÊ©üÂà∂ÂèØ‰ª•Áî®‰æÜÁ¢∫Ë™çÁØÄÈªûÁöÑ‰ΩçÁΩÆÔºåÁõÆÁöÑÊòØÁÇ∫‰∫ÜÁ¢∫‰øù‰ª•ÊúÄÂ∞èÂåñ NUMA Ë∑ùÈõ¢ÁöÑÊñπÂºèÂàÜÈÖçË®òÊÜ∂È´îÔºåÂú®Âü∑Ë°å process ÊúüÈñìÔºålocality ÂèØËÉΩÊúÉÂèóÂà∞Ë®±Â§öÂõ†Á¥†ÂΩ±ÈüøÔºåÂ¶Ç scheduler, memory allocation Á≠âÁ≠âÔºåÂõ†Ê≠§ kernel ÈúÄË¶ÅËÉΩÂ§†Âú® process Âü∑Ë°åÊôÇÁßªÂãïË®òÊÜ∂È´îÈ†ÅÈù¢ÔºåÈÄôÁ®±ÁÇ∫ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]</p><p>ÈóúÊñºË®òÊÜ∂È´îÂàÜÈÖç‰πüÂèØ‰ª•ÈÄöÈÅé process Êú¨Ë∫´Âª∫Á´ãË®òÊÜ∂È´îÁöÑÁ≠ñÁï•ÈÄ≤Ë°åÊéßÂà∂Ôºå‰æãÂ¶Ç process ÂèØ‰ª•Áü•ÈÅì‰ΩøÁî®ÁöÑË®òÊÜ∂È´î‰ΩçÊñºÂì™‰∏ÄÂÄãÁØÄÈªûÁ≠âÁ≠â„ÄÇ</p><h3 id=numa>[[NUMA]]</h3><p>NUMA ÁÇ∫Èùû‰∏ÄËá¥ÊÄßË®òÊÜ∂È´îÂ≠òÂèñÔºåÈö®ËëóËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†ÔºåNUMA ÊäÄË°ìË∂ä‰æÜË∂äÈáçË¶ÅÔºåÂõ†ÁÇ∫ËôïÁêÜÂô®Êï∏ÈáèÂ¢ûÂä†Â∞çÊñºÊßãÂª∫ UMA Á≥ªÁµ±ÊúÉËÆäÂæóË∂ä‰æÜË∂äÂõ∞Èõ£ÔºåNUMA Á≥ªÁµ±Ëàá‰∏ÄËà¨ÂÖ∑ÊúâÂ§öËôïÁêÜÂô®ÁöÑÂ∏∏Ë¶èÁ≥ªÁµ±Â∑ÆÂà•Âú®Êñº‰∏Ä‰∫õË®òÊÜ∂È´îÊòØÂ±¨ÊñºËôïÁêÜÂô®ÁöÑÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂèØ‰ª•ÊúâÊúÄÂ∞èÁöÑÂª∂ÈÅ≤ÊôÇÈñìÂíåÊúÄÈ´ò throughputÔºåËÄåÂÖ∂‰ªñË®òÊÜ∂È´îÂ±¨ÊñºÈÅ†Á´ØÁöÑÔºåÊÄßËÉΩ‰∏ä‰∏çÂ¶ÇÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂª∂ÈÅ≤Êõ¥Â§ßÔºåÊõ¥Â∞èÁöÑ throughput„ÄÇ</p><p>‰∏ãÈù¢Â∞áÊúÉ‰ªãÁ¥πÂú®Ê≤íÊúâ NUMA ÊÉÖÊ≥Å‰∏ãË®òÊÜ∂È´îÁÆ°ÁêÜÊòØÂ¶Ç‰ΩïÈÅã‰ΩúÁöÑÔºåÁÑ∂ËÄåÁúãÂà∞Ë®òÊÜ∂È´îÁÆ°ÁêÜÊ©üÂà∂Âú®ËÄÉÊÖÆ NUMA ÁöÑÊÉÖÊ≥ÅÂÅöÂá∫‰∫ÜÂì™‰∏Ä‰∫õË™øÊï¥ÔºåÊé•ËëóÊòØÈ´òÊïàÁéáÂàÜÈÖçË®òÊÜ∂È´îÊúÉÈÅáÂà∞ÁöÑÂïèÈ°åÔºåÁÑ∂ÂæåË®éË´ñÊú¨Âú∞Ë®òÊÜ∂È´îÂõûÊî∂‰ª•ÂèäË®òÊÜ∂È´îÈÅ∑ÁßªÁöÑÂïèÈ°å„ÄÇ</p><p>ÊúÄÂæåÁúãÂà∞ Linux process Â¶Ç‰ΩïÊâãÂãïÊéßÂà∂ NUMA Á≥ªÁµ±‰∏≠Ë®òÊÜ∂È´îÂàÜÈÖçÔºå‰ΩøÁî®ÁöÑÊñπÊ≥ïÈ¶ñÂÖàÊòØ memory policiesÔºå‰ª•Âèä cpusets„ÄÇ</p><h3 id=example-of-numa-system>Example of NUMA system</h3><p>Â∞çÊñº SMP (Symmetric Multi-Processor) ‰ª•Âèä UP (Single Processor) Á≥ªÁµ±‰æÜË™™ÔºåË®òÊÜ∂È´îÊòØÁµ±‰∏ÄÁöÑÔºå‰πüÂ∞±ÊòØÂ≠òÂèñÊâÄÊúâË®òÊÜ∂È´îÊúâÁõ∏ÂêåÁöÑÊàêÊú¨„ÄÇÂú® NUMA Á≥ªÁµ±‰∏≠ÊúÉÂõ†ÁÇ∫ NUMA Ë∑ùÈõ¢ËÄåÊúâÊâÄÂ∑ÆÁï∞ÔºåÂÑ™Âåñ NUMA Á≥ªÁµ±‰∏äÂü∑Ë°åÁöÑÊáâÁî®Á®ãÂºèÊú¨Ë≥™‰∏äÊàëÂÄëÂ∏åÊúõ‰ª•ÊúÄ‰Ω≥ÊïàËÉΩÁöÑÊîæÁΩÆÊáâÁî®Á®ãÂºè‰ΩøÁî®Âà∞ÁöÑË≥áÊñôÁµêÊßãÁ≠âÁ≠â„ÄÇ</p><p>ÈóúÊñº NUMA Ë∑ùÈõ¢ (NUMA distance)Ôºåkernel ÊúÉËóâÁî± ACPI (Advanced Configuration and Power Interface) ‰ª•Âèä SLIT (System Locality Information Table) ‰æÜÁç≤Âæó„ÄÇÊ†πÊìö ACPI ÁöÑÊ®ôÊ∫ñÔºåSLIT Ë°®‰∏≠Áî®ÊñºÂ∏∏Ë¶è SMP Ê®°ÂºèÁöÑË®òÊÜ∂È´îÂ≠òÂèñÂíåÊú¨Âú∞ NUMA Ë∑ùÈõ¢ÁöÑÂÄºË¢´Ê®ôÊ∫ñÂåñÁÇ∫ 10Ôºå‰πüÂ∞±ÊòØÊú¨Âú∞Ë®òÊÜ∂È´îÂ≠òÂèñÂÆöÁæ©ÁÇ∫ 10ÔºåÂÖ∂‰ªñË∑ùÈõ¢ÊúÉÊ†πÊìöÈÄôÂÄãÁõ∏Â∞çÂÄº‰æÜÊ±∫ÂÆöÔºå‰æãÂ¶ÇË∑®ÁØÄÈªûÁöÑ NUMA Â≠òÂèñË∑ùÈõ¢ÊúÉÊØî 10 ÈÇÑË¶ÅÂ§ß„ÄÇ</p><p><img src=/p/linux_numa_system/1.png width=647 height=312 srcset="/p/linux_numa_system/1_hu_ff9ea0d35bd9c316.png 480w, /p/linux_numa_system/1_hu_cb1ef2a9a283b88d.png 1024w" loading=lazy alt="‚ÄúNUMA Ê®°ÂûãÂúñ‚Äù" class=gallery-image data-flex-grow=207 data-flex-basis=497px></p><p>‰∏äÈù¢ÈÄôÊòØ‰∏ÄÂºµ NUMA Ê®°ÂûãÂúñÔºåÁÅ∞Ëâ≤ÁÇ∫‰∏ÄÂÄã NUMA ÁØÄÈªûÔºåÈÄô‰∏Ä‰∫õ NUMA ÁØÄÈªûËóâÁî± NUMA Interconnect ‰æÜÈÄ£Áµê„ÄÇÊØè‰∏ÄÂÄã NUMA ÁØÄÈªûÊúâÂÖ©ÂÄã processorsÔºå‰ª•Âèä‰∏ÄÂÄã local memory Âíå cachelines</p><p>ÂÅáË®≠Â¶ÇÂúñÊâÄÁ§∫ÔºåÊúâ‰∏ÄÂÄã process Âú® Node 2 ‰∏äÈù¢ÁöÑ 4 Ëôü CPU ‰∏äÈù¢Âü∑Ë°åÔºåÂ¶ÇÊûúÊàëÂÄëÂ≠òÂèñÊú¨Âú∞Ë®òÊÜ∂È´îÔºåÂâá NUMA Ë∑ùÈõ¢ÁÇ∫ 10„ÄÇË©≤ process Âú® Node 2 ‰∏äÈù¢Âü∑Ë°åÔºåÂõ†Ê≠§ÊîæÂú® Node 2 ‰∏äÁöÑË®òÊÜ∂È´îÂ∞çÊñºÊàëÂÄë‰æÜË™™Â∞±ÊòØÊú¨Âú∞Ë®òÊÜ∂È´îÔºåË∑ùÈõ¢ÁÇ∫ 10ÔºåÈÄôÊòØÂèØËÉΩÁöÑÊúÄÂ∞è NUMA Ë∑ùÈõ¢„ÄÇ</p><p>Â¶ÇÊûú CPU 4 ‰∏äÂü∑Ë°åÁöÑ process Ë¶ÅÂ≠òÂèñ Node1 ‰∏äÈù¢ÁöÑË®òÊÜ∂È´îÔºåÂâáÈúÄË¶ÅÈÄöÈÅé NUMA interlink ÈÄ≤Ë°åÂ≠òÂèñÔºå‰∏¶‰∏îÈúÄË¶ÅÂ∞áÁµêÊûúÁßªÂãïÂõûÂà∞Êú¨Âú∞ÔºåÈÄôÊØîËµ∑Â≠òÂèñÊú¨Âú∞ÁØÄÈªû‰∏äÁöÑË®òÊÜ∂È´î‰æÜÊÖ¢ÁöÑË®±Â§ö„ÄÇÂÅáË®≠Â≠òÂèñ Node1 ‰∏äÈù¢Ë®òÊÜ∂È´îÁöÑ NUMA Ë∑ùÈõ¢ÁÇ∫ 14ÔºåË°®Á§∫[[ÈÅ†Á´ØÂ≠òÂèñ]] ÊòØÊú¨Âú∞Â≠òÂèñÁöÑ 1.4 ÂÄç„ÄÇNUMA Ë∑ùÈõ¢ÊòØÊäΩË±°Ê¶ÇÂøµÔºåÊúÉÈö®ËëóÁ°¨È´îÊäÄË°ìÂíå NUMA ‰∫íÈÄ£ÈÄüÂ∫¶ÊúâÊâÄÊîπËÆäÔºåËºÉÂø´‰∫íÈÄ£ÈÄüÂ∫¶ÂèØÈôç‰ΩéÈÅ†Á®ãÂ≠òÂèñÁöÑÂª∂ÈÅ≤„ÄÇ</p><p>Âú®‰ΩøÁî® NUMA ÁØÄÈªûÊôÇ‰πüÈúÄË¶ÅÁâπÂà•Ê≥®ÊÑèË©≤ÁØÄÈªûÂ§ñËÅØÁöÑ I/O Ë®≠ÂÇôÔºå‰æãÂ¶ÇÂú® Node1 ‰∏äÈù¢Âü∑Ë°åÁöÑ Process ‰∏çÈúÄË¶ÅÁ∂ìÈÅé NUMA interlink ‰æÜÂ≠òÂèñÂ§ñÈÉ®Ë®≠ÂÇôÔºåÂêåÊ®£ÁöÑ Node4 ‰πüÊúâÂ∑Æ‰∏çÂ§öÁöÑÁãÄÊ≥Å„ÄÇ</p><h3 id=ÈóúÊñº-linux-mememory-management>ÈóúÊñº Linux Mememory Management</h3><p><img src=/p/linux_numa_system/2.png width=498 height=470 srcset="/p/linux_numa_system/2_hu_51fd1c245e01481c.png 480w, /p/linux_numa_system/2_hu_8be1bfbf3f9dd084.png 1024w" loading=lazy alt="‚ÄúLinux Memory Management ÁöÑÊ¶ÇÂøµÂúñ‚Äù" class=gallery-image data-flex-grow=105 data-flex-basis=254px></p><p>‰∏äÈù¢ÊòØÁ∞°ÂñÆÁöÑ Linux Memory Management ÁöÑÊ¶ÇÂøµÂúñÔºåÊ†∏ÂøÉÈÉ®ÂàÜÁÇ∫ÁÇ∫ page allocatorÔºåpage allocator ‰ª• page ÁÇ∫Â§ßÂ∞èÂàÜÈÖç‰∏ÄÂ°äÂèà‰∏ÄÂ°äÁöÑË®òÊÜ∂È´î„ÄÇ</p><p>ÈÄöÂ∏∏ page Â§ßÂ∞èÁÇ∫ 4KBÔºåÂú® Itanium ‰∏äÈù¢ÂèØËÉΩÁÇ∫ 16k„ÄÇÊâÄÊúâÂÖ∂‰ªñË®òÊÜ∂È´îÂàÜÈÖçÂô®ÈÉΩÊòØÊüêÁ®ÆÁ®ãÂ∫¶‰∏äÂü∫Êñº page allocator ÁöÑÔºå‰∏¶‰∏îÂæû page allocator ÁÆ°ÁêÜÁöÑ pool ‰∏≠ÂèñÂá∫È†ÅÈù¢ÔºåÈ†ÅÈù¢ÂèØ‰ª•Êò†Â∞ÑÂà∞ process ÁöÑ virtual memory space ‰∏≠ÔºåÈÄöÂ∏∏Êò†Â∞ÑÂà∞ userspace ÁöÑ page ÊúâÂÖ©Á®Æ‰ΩøÁî®ÊñπÂºè</p><ol><li>‰∏ÄÁ®ÆÊòØÁî®Êñº anon page ÊàñÊòØË™™ [[anon memory]]Ôºå‰∏çÂíåÊ™îÊ°àÈóúËÅØÔºåÈÄöÂ∏∏Áî®ÊñºËÆäÊï∏Ôºåstack, heap Á≠âÁ≠âÔºåanon page ÊØîËºÉËºïÈáèÔºåÈÄöÂ∏∏ÊØî file backed pages ÈÇÑË¶ÅÈ´òÊïàÔºåÂõ†ÁÇ∫‰∏çÈúÄË¶ÅÊò†Â∞ÑÂà∞Ë®òÊÜ∂È´î (Êò†Â∞ÑÂà∞Ë®òÊÜ∂È´îÁöÑÈ†ÅÈù¢ÈúÄË¶ÅÁ∂ìÈÅéÂ∫èÂàóÂåñÊâçÂèØ‰ª•Â≠òÂèñ)„ÄÇÂ¶ÇÊûúË®òÊÜ∂È´î‰∏çË∂≥ÊôÇÔºåÂèØ‰ª•Â∞á anon page swap Âá∫ÂéªÔºå‰∏çÈÅéÈÄôÊúÉÂ¢ûÂä†Êú™‰æÜËôïÁêÜË©≤È†ÅÈù¢ÊâÄÈúÄË¶Å‰ªòÂá∫ÁöÑÈñãÈä∑</li><li>Âè¶Â§ñÁÇ∫ page cache ÊàñÊòØ buffer, ÈÄöÂ∏∏ÈÄô‰∏Ä‰∫õÊúÉÂÑ≤Â≠òÂú®‰∏Ä‰∫õËºîÂä©ÂÑ≤Â≠òÂ™í‰ªã‰∏äÔºåÂ¶ÇÁ°¨Á¢üÁ≠âÁ≠âÔºåÂ¶ÇÊûúË®òÊÜ∂È´îÈù¢Ëá®Â£ìÂäõÊàñÊòØË≥áÊ∫ê‰∏çË∂≥ÊôÇÔºåÂâá page cache ÂèØËÉΩË¢´ÁßªÈô§ÔºåÂõ†ÁÇ∫ page cache ÂèØ‰ª•‰πãÂæåÈÄöÈÅéÁ°¨Á¢üÈÄ≤Ë°åÊÅ¢Âæ©„ÄÇpage cache ÂåÖÂê´ process ‰∏≠ÁöÑÂèØÂü∑Ë°åÁ®ãÂºèÁ¢ºÔºåÂèØÂü∑Ë°åÁ®ãÂºèÁ¢ºÂèØ‰ª•ÈÄöÈÅé mmap Êò†Â∞ÑÂà∞ÂÖ∂‰ªñ memory space ‰∏≠„ÄÇ</li></ol><p>kernel Êú¨Ë∫´‰πüÈúÄË¶Å‰∏Ä‰∫õ page ‰æÜÂÑ≤Â≠ò‰∏Ä‰∫õ meta dataÔºåÂ¶ÇÁî®Êñº fs ÁöÑÁ∑©Ë°ùÂçÄÔºåÊ≠§Â§ñ kernel ÈÇÑÈúÄË¶ÅÁÇ∫‰∏çÂêåÂ§ßÂ∞èÁöÑ struct ÂàÜÈÖçË®òÊÜ∂È´îÔºåÈÄô‰∫õÁµêÊßã‰ΩøÁî®ÁöÑÂñÆ‰ΩçÂèØËÉΩ‰∏çÊòØ‰ª• page ÁÇ∫Â§ßÂ∞è„ÄÇÁÇ∫Ê≠§ÔºåÊúâ‰∫Ü slab ÂàÜÈÖçÂô®Ôºåslab ÂàÜÈÖçÂô®ÂæûÈ†ÅÈù¢ÂàÜÈÖçÂô®‰∏≠Êü•Ë©¢ÂñÆÂÄã page ÊàñÊòØÈÄ£Á∫åÁöÑ pageÔºåÊé•ËëóÈÅãÁî®Ëá™Â∑±ÁöÑÂÖßÈÉ®ÈÇèËºØÔºåÊ†πÊìö kernel ÊàñÊòØ driver ÂàÜÈÖç‰∏çÂêåÂ§ßÂ∞èÁöÑË®òÊÜ∂È´îÂçÄÂ°ä„ÄÇ slab ÂàÜÈÖçÂô®‰ΩøÁî®‰∫ÜË®±Â§öÈ´òÊ†°Á∑©Ë°ùÊäÄË°ìÔºåÂ∞çÊñºÂ∞èÁâ©‰ª∂ÁöÑË®òÊÜ∂È´îÂàÜÈÖç‰æÜË™™ÔºåÊÄßËÉΩÈùûÂ∏∏ÁöÑÂ•Ω„ÄÇslab ‰∏ªË¶ÅÁî®Âú®Ê™îÊ°àË¢´ÈñãÂïüÁöÑÁõ∏ÈóúË®äÊÅØÔºåÊàñÊòØÊúÄËøë‰ΩøÁî®ÁöÑÊ™îÊ°àÂêçÁ®±ÔºåÊääÈÄô‰∏Ä‰∫õË≥áË®äÁ∑©Ë°ùËµ∑‰æÜÂä†ÈÄü fs Êü•Ë©¢Êìç‰ΩúÔºåÊàñÊòØÂÖ∂‰ªñÂ¶Ç kernel ‰∏≠Áî®ÁöÑ lock, Êüê‰∫õÁâ©‰ª∂ÁöÑÁãÄÊÖãÁ≠âÁ≠â„ÄÇ</p><p>device driver ÊúÉÂà©Áî® page allocator ‰ª•Âèä slab allocator ‰æÜÂàÜÈÖçË®òÊÜ∂È´îÂíåÁÆ°ÁêÜ deviceÔºådevice driver Ê†πÊìöÊâÄÈúÄË¶ÅÁöÑ page sized ÈÇÑÊúâÂÖ∂‰ªñ‰∏çÂêåÁöÑËÆäÈ´îÔºåÂ¶Ç vmallocÔºåÂèØ‰ª•ÂàÜÈÖçÊØîËºÉÂ§ßÁöÑË®òÊÜ∂È´î chunksÔºåÈÄô‰∫õË®òÊÜ∂È´îÂ°äÂú® kernel context ‰∏≠ÁúãËµ∑‰æÜ‰ºº‰πéÈÄ£Á∫åÔºå‰ΩÜÂØ¶Èöõ‰∏äÂú®Áâ©ÁêÜ‰∏ä‰∏¶‰∏çÊòØÈÄ£Á∫åÁöÑ„ÄÇvmalloc ÂèØ‰ª•ÁÇ∫Â§ßÂ°äË®òÊÜ∂È´îÁî¢ÁîüÂá∫Âπæ‰πéÈÄ£Á∫åÁöÑË®òÊÜ∂È´î„ÄÇvmalloc Âç≥‰æøÈÅáÂà∞Á≥ªÁµ±Á¢éÁâáÂåñÁ≠âÂïèÈ°åÔºåÂ¶ÇÊûú page allocator ÁÑ°Ê≥ïÊèê‰æõÁâ©ÁêÜ‰∏äÈÄ£Á∫åÁöÑË®òÊÜ∂È´îÔºåÈÄôÊôÇÂÄôÂ∞±ÂèØ‰ª•‰ΩøÁî® vmalloc ËôïÁêÜ„ÄÇvmalloc Âú® kernel space ‰∏äË®òÊÜ∂È´îÈÄ£Á∫åÔºå‰ΩÜÊòØÂú®Áâ©ÁêÜË®òÊÜ∂È´îÂú∞ÂùÄ‰∏ä‰∏çÊòØÈÄ£Á∫åÁöÑ„ÄÇ‰ΩÜ vmalloc ‰πüÊúâÂÖ∂Áº∫ÈªûÔºåÈÄöÂ∏∏ÈúÄË¶ÅÈÄöÈÅé page table ÈÄ≤Ë°åËΩâÊèõÔºåËàáÁõ¥Êé•Âæû page allocator ÊàñÁöÑÁâ©ÁêÜÂú∞ÂùÄÁõ∏ÊØîÔºåÈÄôÊ®£ËΩâÊèõÂ§ö‰∫Ü overheadÔºå‰∏î vmalloc Âè™ËÉΩÁî®Âú® kernel ‰∏≠ÔºåÁÑ°Ê≥ïÊò†Â∞ÑÂà∞ userspace ÁöÑÁ®ãÂºè„ÄÇ</p><p>Â∞çÊñº PCI Ë®≠ÂÇôÔºåÈÄöÂ∏∏ÊúÉ‰ΩøÁî® dma_alloc_coherent ÂáΩÊï∏ÔºåÈÄôÊòØÂ∞àÈñÄÁî®Êñº DMA Êìç‰ΩúÁöÑË®òÊÜ∂È´îÔºåDMA Ë®òÊÜ∂È´îÊúâÂπæÂÄãÁâπÈªûÔºå‰æãÂ¶Ç‰∏ÄËá¥ÊÄßÔºåDMA Ë®òÊÜ∂È´îÂ∞ç CPU Âíå PCI Á≠âË®≠ÂÇô‰øùÊåÅ‰∏ÄËá¥ÊÄßÔºåÈÄôË°®Á§∫‰∏çÈúÄË¶ÅÈ°çÂ§ñÁöÑ buffer ÊàñÊòØ cache Áî®‰æÜÂêåÊ≠•Êìç‰Ωú„ÄÇ‰∏çÂêåÁ°¨È´îÂπ≥Âè∞Â∞çÊñº DMA Ë®òÊÜ∂È´îË¶ÅÊ±ÇÂèØËÉΩÀô‰∏çÂêåÔºåÂ¶ÇË®òÊÜ∂È´îÂ∞çÈΩäÔºåË®òÊÜ∂È´îÂú∞ÂùÄÁØÑÂúçÊàñÊòØÊò†Â∞ÑÊñπÂºèÔºådma_alloc_coherent Áç≤ÂæóÁöÑË®òÊÜ∂È´îÂæàÂ§ßÁ®ãÂ∫¶‰æùË≥¥ÊñºÂ∫ïÂ±§Á°¨È´îÂØ¶Áèæ„ÄÇÊúâ‰∫õÁ°¨È´îÂèØËÉΩÊîØÊè¥‰ΩøÁî® Huge Page ÊèêÂçá DMA ÊïàËÉΩÁ≠âÁ≠â</p><p>‰ª•‰∏ãÁÇ∫ÈóúÊñº Linux Ë®òÊÜ∂È´îÂàÜÈÖçÁöÑÁõ∏Èóú API</p><p><img src=/p/linux_numa_system/3.png width=774 height=261 srcset="/p/linux_numa_system/3_hu_5809e364367294cc.png 480w, /p/linux_numa_system/3_hu_f31bb31122ec66b7.png 1024w" loading=lazy alt="‚ÄúLinux Ë®òÊÜ∂È´îÂàÜÈÖçÁöÑÁõ∏Èóú API‚Äù" class=gallery-image data-flex-grow=296 data-flex-basis=711px></p><h3 id=ÈóúÊñº-numa-Ë®òÊÜ∂È´î>ÈóúÊñº NUMA Ë®òÊÜ∂È´î</h3><p>Âú® NUMA Á≥ªÁµ±‰∏≠ÊØèÂÄãÁØÄÈªûÁöÑË®òÊÜ∂È´îÊòØÂñÆÁç®ÁÆ°ÁêÜÁöÑÔºåÊØèÂÄãÁØÄÈªûÈÉΩÂ≠òÂú®Êñº page pools ‰∏≠„ÄÇÊØèÂÄãÁØÄÈªûÈÉΩËàá swapper thread ÊâÄÈóúËÅØÔºåÁî®‰æÜËôïÁêÜË®òÊÜ∂È´îÂõûÊî∂„ÄÇÁØÄÈªû‰∏≠ÁöÑÊØèÂÄãË®òÊÜ∂È´îÂú∞ÂùÄÁØÑÂúçÁ®±ÁÇ∫ÂàÜÈÖçÂçÄÂüü„ÄÇ</p><p>Âú® Linux ‰∏≠Êúâ‰∏ÄÂÄãÊ©üÂà∂Á®±ÁÇ∫ zone structure, Ë£°Èù¢ÂåÖÂê´ free list Â≠òÊîæÂèØ‰ª•‰ΩøÁî®ÁöÑË®òÊÜ∂È´îÂàÜÈ†ÅÔºåzone ÁµêÊßãÊòØ Linux kernel Áî®‰æÜÁµÑÁπî‰ª•ÂèäÁÆ°ÁêÜÁâ©ÁêÜË®òÊÜ∂È´îÁöÑ‰∏ÄÁ®ÆÁµêÊßã</p><ul><li>ZONE_DMA: ‰ΩéË®òÊÜ∂È´îÂú∞ÂùÄË®òÊÜ∂È´îÔºåÁî®‰æÜÊîØÊè¥ÈúÄË¶ÅÁâπÂÆöË®òÊÜ∂È´îÂçÄÂüüÁöÑ DMA device</li><li>ZONE_NORMAL: ÊôÆÈÄöË®òÊÜ∂È´îÂçÄÂüüÔºåÁî®Êñº kernel Âíå ÊáâÁî®Á®ãÂºèÁöÑË®òÊÜ∂È´îÂàÜÈÖç</li><li>ZONE_HIGHMEM: ‰∏ªË¶ÅÁî®Êñº 32 bit Á≥ªÁµ±
ËÄåÂõûÊî∂Á≠ñÁï•ÈÉ®ÂàÜÔºå‰ΩøÁî® active list ‰ª•Âèä inactive list ÁÆ°ÁêÜÂõûÊî∂Ê©üÂà∂Ôºåpage ÊúÉÂú®ÈÄôÂÖ©ÂÄã list ‰πãÈñìÁßªÂãï‰ª•Á¢∫Ë™çÂì™‰∏Ä‰∫õ page ÂèØ‰ª•ÂõûÊî∂ÔºåÂ¶ÇÊûúÂ≠òÂèñ‰ΩçÊñº inactive list Ë£°Èù¢ÁöÑ pageÔºåÂâáË©≤ page ÊúÉÁßªÂãïÂà∞ active list„ÄÇswapper ÊúÉÂ∞á page Âæû active list ÁßªÂãïÂà∞ inactive listÔºåÂ¶ÇÊûúÈÅáÂà∞Ë®òÊÜ∂È´îË≥áÊ∫êÂêÉÁ∑äÊôÇÔºåÊúÉÂæû inactive list Êú´Á´ØÈñãÂßãÂõûÊî∂ page„ÄÇ</li></ul><p>Â¶ÇÊûúÊàëÂÄëÂú® NUMA ‰∏äÁôºÂá∫Ë´ãÊ±ÇÂàÜÈÖçË®òÊÜ∂È´îÁöÑË´ãÊ±ÇÔºåÊàëÂÄëÂ∞áÈúÄË¶ÅÊ±∫ÂÆöÂæûÂì™‰∏ÄÂÄãÁØÄÈªû‰∏äÁöÑÂì™ÂÄã pool ÂéªÂæóÂà∞Ë®òÊÜ∂È´î„ÄÇÂ¶ÇÊûúÊ≤íÊúâ cpuset ÈôêÂà∂ÔºåNUMA Á≥ªÁµ±ÊúÉÂòóË©¶Â∞áË®òÊÜ∂È´îÂàÜÈÖçÂà∞ process Ê≠£Âú®Âü∑Ë°åÁöÑÁØÄÈªû‰∏äÔºåÂéüÂõ†ÁÇ∫Êñ∞ÂàÜÈÖçÁöÑË®òÊÜ∂È´îÈÄöÂ∏∏Âú®ÂàÜÈÖç‰πãÂæåÂæàÂ∏∏Ë¢´‰ΩøÁî®ÔºåÈÄôÂÄãÁµêË´ñÂèØ‰ª•Âæû [[TPP Transparent Page Placement for CXL-Enabled Tiered-Memory]] ÂæóÁü•ÔºåÂõ†ÁÇ∫‰ªñÊòØ hot ÁöÑÔºåÊää‰ªñÊîæÂú®Êú¨Âú∞Ë®òÊÜ∂È´îÊòØÂêàÁêÜÁöÑ„ÄÇ</p><p>‰ΩÜÊúâÂèØËÉΩÊàëÂÄëÈúÄË¶ÅÁöÑË®òÊÜ∂È´îË∂ÖÈÅéÁõÆÂâçÁØÄÈªûÊâÄËÉΩÂ§†Êèê‰æõÁöÑÊï∏ÈáèÔºåÊàëÂÄëÈúÄË¶ÅÊüê‰∏Ä‰∫õÊ©üÂà∂ËÆìÊàëÂÄëËÉΩÂ§†ÊåáÂÆöË®òÊÜ∂È´îÊáâË©≤ÂàÜÈÖçÂú®Âì™‰∏Ä‰∫õÁØÄÈªûÔºåÈÅøÂÖçÂñÆ‰∏ÄÁØÄÈªûÈÅéËºâÁ≠âÁ≠â„ÄÇÊàñÊòØ‰∏Ä‰∫õÁâπÊÆäÂ†¥ÊôØÔºåÂ¶Ç driver ÈñãÁôºËÄÖÂ∑≤Á∂ìÁü•ÈÅìÊüêÂÄãË≥áÊñôÁµêÊßã‰∏çÊúÉÈÇ£È∫ºÂ∏∏Ë¢´Â≠òÂèñÔºåÊàñÊòØÂÖ∂‰ªñÁØÄÈªûÊúÉÊõ¥È†ªÁπÅÁöÑÂ≠òÂèñË©≤ÁµêÊßãÔºåÂâáÂàÜÈÖçÂú®Êú¨Âú∞ÁØÄÈªûÂ∞±‰∏çÊúÉÊòØÊúÄ‰Ω≥Ëß£‰∫Ü„ÄÇÁÇ∫‰∫ÜÊáâÂ∞çÊõ¥‰Ω≥Áé≤ÁæÖÁöÑÈúÄÊ±ÇÔºåNUMA ‰∏≠ÊúÉÊúâÂ∏∂Êúâ <code>_node</code> ÂæåÁ∂¥ÁöÑÂáΩÊï∏ÔºåÁÇ∫ NUMA Á≥ªÁµ±‰ΩøÁî®ÁöÑÂàÜÈÖçÂô®Ôºå‰æãÂ¶Ç kmalloc_node() ÂèØ‰ª•Áõ¥Êé•ÂàÜÈÖçË®òÊÜ∂È´îÂú®ÁõÆÊ®ôÁØÄÈªû‰∏ä„ÄÇ‰ª•‰∏ãË°®Ê†ºÊï¥ÁêÜ‰∫Ü NUMA Áõ∏ÈóúË®òÊÜ∂È´îÂàÜÈÖçÂô®</p><p><img src=/p/linux_numa_system/4.png width=777 height=342 srcset="/p/linux_numa_system/4_hu_23baccbdd1f23da1.png 480w, /p/linux_numa_system/4_hu_af40667aaf90ffb9.png 1024w" loading=lazy alt="‚ÄúNUMA ÂàÜÈÖçÂô®‚Äù" class=gallery-image data-flex-grow=227 data-flex-basis=545px></p><h3 id=ÊúÄ‰Ω≥ÊáâÁî®-numa-ÁöÑÊáâÁî®Á®ãÂºèÁâπÂæµ>ÊúÄ‰Ω≥ÊáâÁî® NUMA ÁöÑÊáâÁî®Á®ãÂºèÁâπÂæµ</h3><p>Âè™Âà©Áî®ÂñÆ‰∏ÄÁØÄÈªûË≥áÊ∫êÁöÑÂ∞èÂûãÊáâÁî®Á®ãÂºèÂèØ‰ª•Âà©Áî®Êú¨Âú∞ÁØÄÈªûÁöÑÊâÄÊúâÂÖÉÁ¥†‰æÜÂØ¶ÁèæÊúÄ‰Ω≥ÈÄüÂ∫¶Âü∑Ë°å„ÄÇÈÄôÂÄãÊáâÁî®Á®ãÂºèÂ¶ÇÊûú‰ΩøÁî®ÁöÑË®òÊÜ∂È´î‰∏çË∂ÖÈÅéÂñÆ‰∏ÄÁØÄÈªûÂèØ‰ª•Êèê‰æõÁöÑË®òÊÜ∂È´îÈáèÔºå‰∏î‰ΩøÁî®ÁöÑ CPU Êï∏Èáè‰∏çË∂ÖÈÅé‰∏ÄÂÄãÁØÄÈªûÂèØ‰ª•Êèê‰æõÁöÑ CPU Êï∏Èáè„ÄÇ</p><h3 id=ÈóúÊñºÂ§öÁØÄÈªûÊáâÁî®Á®ãÂºè>ÈóúÊñºÂ§öÁØÄÈªûÊáâÁî®Á®ãÂºè</h3><p>Â¶ÇÊûúÊú¨Âú∞ÁØÄÈªûÁöÑË≥áÊ∫ê‰∏çË∂≥‰ª•‰æõÊáâÁµ¶‰∏ÄÂÄãÊáâÁî®Á®ãÂºè‰ΩøÁî®ÔºåÂâáÊàëÂÄëÂã¢ÂøÖÈúÄË¶ÅÂ≠òÂèñÂà∞ÈùûÊú¨Âú∞ÁØÄÈªûÁöÑË≥áÊ∫êÔºåÂ∞çÊñºÊáâÁî®Á®ãÂºè‰∏≠ÁöÑË≥áÊ∫êÔºåÂ§ßËá¥‰∏äÂèØ‰ª•ÂàÜÊàê Thread specific data, Shared read/write data, Shared read/only data ÈÄô‰∏âÁ®ÆÔºåÈÄô‰∏âÁ®ÆÊúâ‰ª•‰∏ãÂπæÁ®ÆÊúÄ‰Ω≥ÂàÜÈÖçË®òÊÜ∂È´îÁöÑÊñπÂºèÂèØ‰ª•ÂèÉËÄÉ</p><ul><li>Thread Specific Data: Áï∂Ë≥áÊñôÂè™Ë¢´Êú¨Âú∞ËôïÁêÜÂô®Â≠òÂèñÊôÇÔºåÂèØ‰ª•ÊääÂÆÉË¶ñÁÇ∫Êú¨Âú∞ÁöÑË≥áÊñôÔºåÂõ†ÁÇ∫ Thread Specific Data ‰∏çÈúÄË¶ÅË∑®ÁØÄÈªûÈÄ≤Ë°åÂ≠òÂèñ</li><li>Shared Read/Write: Â¶ÇÊûúÊüê‰∫õË≥áÊñôË¢´ÊâÄÊúâÁØÄÈªû‰ª•Áõ∏ÂêåÁöÑÊ©üÁéáÂ≠òÂèñÔºåÈÇ£È∫ºÊúÄÂ•ΩÁöÑÊñπÊ≥ïÂ∞±ÊòØÊääË≥áÊñôÂùáÂãªÂú∞ÂàÜÂ∏ÉÂú®ÊâÄÊúâÁØÄÈªû‰∏ä„ÄÇÈÄôÁ®ÆÂàÜÈÖçÁ≠ñÁï•ÈÄöÂ∏∏ÊúÉÈÄöÈÅé interleave memory ÊàñÊòØ memory spreading ÂØ¶Áèæ</li><li>Shared Read/Only: Áï∂Ë≥áÊñôÊòØÈ´òÈ†ªÁéáÁöÑ Read/Only ÊôÇÔºåÊúÄÂ•ΩÁöÑÁ≠ñÁï•ÊòØËÆìÊØè‰∏ÄÂÄãÁØÄÈªûÈÉΩÊúâ‰∏Ä‰ªΩËá™Â∑±ÁöÑÊã∑Ë≤ùÔºåÈÄôÊ®£ÊØè‰∏ÄÂÄãÁØÄÈªûÂè™Ë¶ÅÂæûËá™Â∑±Êú¨Âú∞ÁØÄÈªûËÆÄÂèñÂ∞±ÂèØ‰ª•ÔºåÁúÅÂéª‰∫ÜË∑®ÁØÄÈªûÂ≠òÂèñÁöÑÈñãÈä∑„ÄÇ‰ΩÜÈúÄË¶ÅÊ≥®ÊÑè Linux ‰∏çÊîØÊè¥Áõ¥Êé•ÈÄ≤Ë°åË≥áÊñôÁöÑËá™ÂãïË§áË£ΩÁÆ°ÁêÜÔºåËÄåÊòØ‰ΩøÁî® interleave memory ÊàñÊòØ memory spreading ‰æÜËôïÁêÜÊâÄÊúâ Shared Data„ÄÇÂ¶ÇÊûúÊáâÁî®Á®ãÂºèÈúÄË¶ÅÈÄôÊ®£ÁöÑÂäüËÉΩÔºåÈÄöÂ∏∏ÈúÄË¶ÅËá™Â∑±ÂØ¶Áèæ</li></ul><h3 id=ÈóúÊñº-linux-‰∏≠-interleave-memory-memory-spreading>ÈóúÊñº Linux ‰∏≠ Interleave Memory, Memory Spreading</h3><p>Interleave Memory (Ë®òÊÜ∂È´î‰∫§ÈåØ): Ê¶ÇÂøµ‰∏äÊòØÂ∞áË®òÊÜ∂È´î‰ª• block ÁöÑÂΩ¢ÂºèÂπ≥ÂùáÂàÜÂ∏ÉÂú® NUMA ÁØÄÈªû‰∏äÔºåÊØè‰∏ÄÂÄã memory block Áî±‰∏çÂêåÁØÄÈªûË≤†Ë≤¨Â≠òÂèñÔºåÂæûËÄåÂØ¶ÁèæÂ≠òÂèñ‰∏äÁöÑË≤†ËºâÂπ≥Ë°°„ÄÇÁï∂Â§öËôïÁêÜÂô®ÈúÄË¶ÅÈ†ªÁπÅÁöÑÂ≠òÂèñ‰∏ÄÊÆµË®òÊÜ∂È´îÊôÇÔºå‰ΩøÁî®ÈÄôÂÄãÊñπÊ≥ïÂèØ‰ª•Èôç‰ΩéÂñÆ‰∏ÄÁØÄÈªûË®òÊÜ∂È´îÊéßÂà∂Âô®ÁöÑÂ£ìÂäõ„ÄÇ</p><p>Âú® Linux ‰∏≠ NUMA Á≠ñÁï•‰∏≠ÁöÑ interleave Ê®°ÂºèÂèØ‰ª•‰ΩøÁî® <code>numactl</code> Â∑•ÂÖ∑‰æÜË®≠ÂÆöÔºåË©≥Á¥∞ usage ÁÇ∫‰ª•‰∏ã</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>numactl --interleave=all ./program
</span></span></code></pre></td></tr></table></div></div><p><code>--interleave=all</code> ÊåáÂÆöË®òÊÜ∂È´îÂ∞áÂùáÂãªÂàÜÂ∏ÉÂú®ÊâÄÊúâ NUMA ÁØÄÈªû‰∏ä</p><p>Âú® Kernel ÁöÑÈÉ®ÂàÜÔºåÊàëÂÄëÂèØ‰ª•‰ΩøÁî® <code>alloc_pages_interleave()</code> ‰æÜ‰ΩøÁî® Interleave Memory ÁöÑÁ≠ñÁï•ÔºåÊàñÊòØ <code>mbind_range</code> Á≠âÁ≠âÔºåË©≥Á¥∞ÂèØ‰ª•ÂèÉËÄÉ kernel source ÊàñÊòØ libC Ë£°Èù¢ÁöÑ <a class=link href=https://linux.die.net/man/3/numa target=_blank rel=noopener><code>numa.h</code></a></p><p>Memory Spreading: Ê¶ÇÂøµ‰∏äÊòØÂ∞áË®òÊÜ∂È´îÂàÜÊï£Âà∞Â§öÂÄãÁØÄÈªûÔºå‰ΩÜÊòØ‰∏çÊúÉÂÉèÊòØ Interleave Memory ÈÇ£Ê®£‰ª•Âõ∫ÂÆö‰∫§ÈåØÊ®°ÂºèÂàÜÂ∏É„ÄÇÂàÜÊï£ÁöÑË®òÊÜ∂È´îÂàÜÂ∏ÉÂèØ‰ª•ËÄÉÊÖÆÊõ¥Âä†ÈùàÊ¥ªÁöÑÊ¢ù‰ª∂Ôºå‰æãÂ¶ÇÁØÄÈªûÁõÆÂâçÁöÑË≤†ËºâÁ®ãÂ∫¶Á≠âÁ≠â„ÄÇÂèØ‰ª•ÊáâÁî®Âú®ÈÅøÂÖçÁØÄÈªûË≥áÊ∫êËÄóÁõ°Ôºå‰øùÊåÅÁ≥ªÁµ±Êï¥ÁêÜË®òÊÜ∂È´î‰ΩøÁî®ÂùáË°°ÔºåÊ¶ÇÂøµÊúâÈªûÂÉèÊòØ Interleave Memory„ÄÇ</p><p>Âú® Linux ‰∏≠ÈÄöÈÅé autoNUMA ÂØ¶Áèæ Memory SpreadingÔºåÈÄôÈÄöÂ∏∏‰∏çÈúÄË¶ÅÈ°ØÂºèË®≠ÂÆö„ÄÇ</p><p>Â¶ÇÊûúË¶ÅÊâãÂãïË®≠ÂÆöÔºåÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ãÊñπÂºèÈÄ≤Ë°åË®≠ÂÆö</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>numactl --preferred<span class=o>=</span><span class=m>0</span> ./program
</span></span></code></pre></td></tr></table></div></div><p>Âú®‰∏äÈù¢Ê°à‰æã‰∏≠ÔºåÂÑ™ÂÖàÂæûÁØÄÈªû 0 ÂàÜÈÖç„ÄÇÁï∂ÁØÄÈªû 0 ÁÑ°Ê≥ïÊªøË∂≥ÈúÄÊ±ÇÊôÇÔºåÂÖ∂‰ªñÁØÄÈªûÁöÑË®òÊÜ∂È´îÊúÉ‰ΩúÁÇ∫ÂÇôÁî®„ÄÇ</p><p>kernel Ë£°Èù¢ NUMA Âπ≥Ë°°Ê©üÂà∂Êúâ‰ΩçÊñº <code>mm/page_alloc.c</code> Ë£°Èù¢ÁöÑ <code>find_next_best_node</code></p><p>Â∞çÊñº NUMA ÊéßÂà∂ÔºålibC ‰πüÊúâÊèê‰æõ‰∏Ä‰∫õ‰ªãÈù¢Áµ¶ÊáâÁî®Á®ãÂºè‰ΩøÁî®ÔºåÂ¶Ç <code>numa.h</code> Ë£°Èù¢ÁöÑ <code>numa_set_interleave_mask</code>ÔºåÊàñÊòØ‰ΩøÁî® <code>numactl</code> ÈÄôÂÄãÂ∑•ÂÖ∑ÈÄ≤Ë°åÊéßÂà∂„ÄÇËÄåËàá kernel Áõ∏Èóú NUMA ÊéßÂà∂Êúâ <code>cat /sys/devices/system/node/node*/meminfo</code>„ÄÇÂ∞çÊñº NUMA Âπ≥Ë°°ÔºåÊúâ <code>echo 1 > /proc/sys/kernel/numa_balancing</code></p><h3 id=ÈóúÊñº-page-cache>ÈóúÊñº page cache</h3><p>Áï∂ Linux ÂæûÁ°¨Á¢üË£°Èù¢ËÆÄÂèñË≥áÊñôÊôÇÔºåÈÄô‰∫õ page ÊúÉË¢´ cache Âà∞Ë®òÊÜ∂È´îË£°Èù¢ÔºåËÄåÈÄôÈÉ®ÂàÜÁöÑË®òÊÜ∂È´îÂ∞±Ë¢´Á®±‰Ωú page cache„ÄÇpage cache ‰∏ªË¶ÅÊòØÁî®‰æÜÊèêÈ´òÁ≥ªÁµ±ÊïàËÉΩÔºåÊ∏õÂ∞ëÁ°¨Á¢ü I/O Êìç‰ΩúÁöÑÊ¨°Êï∏„ÄÇpage cache ‰∏çÂè™ÊòØÁî®‰æÜÂÅö cacheÔºåÈÇÑÊúâ‰ª•‰∏ãÁî®ÈÄî</p><ol><li>Executable Pages: Áï∂Á®ãÂºèÈúÄË¶ÅÂü∑Ë°åÊüê‰∫õÂæûÁ°¨Á¢üËºâÂÖ•ÁöÑ‰∫åÈÄ≤‰ΩçÊ™îÊ°àÊôÇÔºåÈÄô‰∫õÈ†ÅÈù¢ÂèØËÉΩË¢´Êò†Â∞ÑÊàêÂèØÂü∑Ë°åÈ†ÅÈù¢Ôºå‰πüÂ∞±ÊòØÂæûÁ°¨Á¢üËÆÄÂèñË≥áÊñôÊôÇÔºåÈÄô‰∫õ page Ë¢´ cache Âà∞Ë®òÊÜ∂È´îË£°Èù¢ÊôÇÔºåpage Êú¨Ë∫´ÂÖ∑ÊúâÂü∑Ë°åÊ¨äÈôê</li><li>Memory Mapped Pages: Êüê‰∫õÁ®ãÂºèÂèØËÉΩÊúÉ‰ΩøÁî® memory-mapped-filesÔºå‰πüÂ∞±ÊòØÊääÊ™îÊ°àÊò†Â∞ÑÂà∞Ë®òÊÜ∂È´îÔºåÂæûËÄåÂØ¶ÁèæÊ™îÊ°àÂà∞Ë®òÊÜ∂È´î‰πãÈñìÁöÑÂ∞çÊáâÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ë®òÊÜ∂È´îÁõ∏Èóú API ÂéªËôïÁêÜÊ™îÊ°àÔºåÈÄöÂ∏∏ÈÄôÁ®ÆÊñπÂºèÊúÉÁî®ÊñºËôïÁêÜÂ§ßÊ™îÊ°àÊàñÊòØÂÖ±‰∫´Ê™îÊ°à„ÄÇ
page cache ‰∏≠ÁöÑÊüêÂÄã page Ë¢´Êò†Â∞ÑÂà∞ÊüêÂÄã process images ‰πãÈ°ûÔºåÂç≥‰æøË©≤ process Ë¢´ kill ‰∫ÜÔºåÈÄô‰∏Ä‰∫õ page ‰πü‰∏çÊúÉË¢´Á´ãÂç≥ÈáãÊîæÔºåÈÄô‰∏ÄÈªûÂíå [[anon memory]] ÊúâÊâÄ‰∏çÂêåÔºå‰πüÂ∞±ÊòØ page cache ÂÖ∑ÊúâÊüêÈÉ®ÂàÜÁöÑÊåÅ‰πÖÊÄß</li></ol><ul><li>Áï∂‰∏ÄÂÄã process ÁµêÊùü‰πãÂæåÔºåpage cache ÊúÉÁπºÁ∫åÁïôÂú®Ë®òÊÜ∂È´î</li><li>ÈÄôÊ®£ÁöÑË®≠Ë®àÊòØÂü∫ÊñºÁ©∫ÈñìÂ±ÄÈÉ®ÊÄßÁöÑËÄÉÊÖÆÔºå‰πüÂ∞±ÊòØÊú™‰æÜÂèØËÉΩÊúâÂÖ∂‰ªñ process ÊúÉÈúÄË¶ÅÁõ∏ÂêåÁöÑ pageÔºåÈÄô‰∫õ page ÂíåÁ°¨Á¢üÁöÑË≥áÊñôÊúâÈóúÔºåÂü∫ÊñºÈÄôÊ®£ÁöÑÂÅáË®≠Ôºå‰πãÂæåÁöÑ process Â∞±ÂèØ‰ª•Ê∏õÂ∞ëÂ∞çÊñºÁ°¨Á¢üÁöÑ I/OÔºåÁõ¥Êé•Âæû page ÊãøË≥áÊñôÔºåÊèêÈ´òÁ≥ªÁµ±ÊïàËÉΩ„ÄÇËàâ‰æã‰æÜË™™ÔºåÂ¶ÇÊûúÊúâÂè¶Â§ñ‰∏ÄÂÄã process ÈúÄË¶ÅÂ≠òÂèñÁõ∏ÂêåÁöÑÊ™îÊ°àÂÖßÂÆπÔºåprocess ÂèØ‰ª•Áõ¥Êé•Âæû page ÊíàË≥áÊñô„ÄÇ‰ΩÜÊòØÁï∂Ë®òÊÜ∂È´îÂ£ìÂäõÂ§ßÊôÇÔºåÈÄô‰∏Ä‰∫õ page ÂèØËÉΩË¢´ÊõøÊèõÊéâÔºåÂèØËÉΩÊòØÂü∫Êñº LRU ÊàñÊòØÂÖ∂‰ªñÁ≠ñÁï•</li></ul><h3 id=ÈóúÊñºË®òÊÜ∂È´îÂõûÊî∂>ÈóúÊñºË®òÊÜ∂È´îÂõûÊî∂</h3><p>‰ª•‰∏ãÁÇ∫ UP Á≥ªÁµ±‰ª•Âèä SMP Á≥ªÁµ±Á∞°ÂñÆÁöÑË®òÊÜ∂È´îÊò†Â∞ÑÊÉÖÊ≥Å</p><p><img src=/p/linux_numa_system/5.png width=602 height=579 srcset="/p/linux_numa_system/5_hu_94851a9eead92063.png 480w, /p/linux_numa_system/5_hu_9b58096262fdc060.png 1024w" loading=lazy alt=‚ÄúË®òÊÜ∂È´îÊò†Â∞Ñ‚Äù class=gallery-image data-flex-grow=103 data-flex-basis=249px></p><p>Áî± process Êò†Â∞ÑÁöÑÈ†ÅÈù¢ÊòØ anon page Âíå page cache page„ÄÇÁï∂ process Ë¢´ kill ÊôÇ‰∏îÂ∑≤Á∂ìÊò†Â∞ÑÁöÑ page cache page ËÆäÊàêÊú™Êò†Â∞ÑÁöÑ page cache pages ÊôÇÔºåË®òÊÜ∂È´îË£°Èù¢Èö®ËëóÊôÇÈñìÊé®ÊôÇÊúÉÊúâË∂ä‰æÜË∂äÂ§öÁöÑÊú™Êò†Â∞Ñ page cache pagesÔºå‰πüÂ∞±ÊòØÈÄô‰∏Ä‰∫õ page cache ‰∏çÂ±¨Êñº‰ªª‰Ωï processÔºåÂ∞éËá¥ Free memory Ê∏õÂ∞ë„ÄÇ</p><p>Áï∂ Free memory ‰ΩéÊñº‰ΩúÊ•≠Á≥ªÁµ±ÈôêÂà∂ÊôÇÔºåswapper ÈñãÂßãÂõûÊî∂Ë®òÊÜ∂È´îÔºåÂ¶ÇÊûúÂ£ìÂäõÊØîËºÉ‰ΩéÔºå‰∏î swapper ÈÅã‰ΩúÁöÑÈ†ªÁéá‰∏¶Ê≤íÊúâÈÇ£È∫ºÈ†ªÁπÅÔºåÂâáÂè™ÊúÉÈáãÊîæ inactive list Ë£°Èù¢ÁöÑÊú™Êò†Â∞ÑÈ†ÅÈù¢ÔºåÈÄôÊ®£ÂèØ‰ª•ÊèêÈ´ò Free memoryÔºå‰∏îÁ¥ØÁ©çÁöÑÊú™Êò†Â∞ÑÂø´ÂèñÈ†ÅÈù¢ÂèØ‰ª•ÈáçÊñ∞ÁöÑË¢´Âà©Áî®„ÄÇ</p><p>Â¶ÇÊûúË®òÊÜ∂È´îÂ£ìÂäõÂ¢ûÂä†Ôºåswapper ÂèØËÉΩÊúÉÊõ¥Âä†ÊøÄÈÄ≤Ôºå‰æãÂ¶ÇÂèñÊ∂àÊò†Â∞ÑÂà∞ process ÁöÑÈ†ÅÈù¢ÔºåÊàñÊòØÊää [[anon memory]] ‰∫§ÊèõÂà∞ swap space ‰∏≠„ÄÇ</p><h3 id=ÈóúÊñº-numa-ÁöÑË®òÊÜ∂È´îÂõûÊî∂>ÈóúÊñº NUMA ÁöÑË®òÊÜ∂È´îÂõûÊî∂</h3><p>Âú® NUMA Á≥ªÁµ±‰∏≠ÔºåÂæàÂ∞ëÁôºÁîüÂÖ®ÂüüÂõûÊî∂Ôºå‰πüÂ∞±ÊòØÈáùÂ∞çÊñºÊâÄÊúâÁØÄÈªûÁöÑÂõûÊî∂Ê©üÂà∂„ÄÇÂõ†ÁÇ∫Ë¶ÅËß∏ÁôºÂÖ®ÂüüÂõûÊî∂ÁöÑÂâçÊèêÊòØÊâÄÊúâÁØÄÈªûË®òÊÜ∂È´îÈÉΩËÄóÁõ°ÔºåÊâçÊúÉËß∏Áôº swapper„ÄÇ</p><p>Âõ†Ê≠§Áï∂ Node1 ‰∏äË®òÊÜ∂È´îËÄóÁõ°ÊôÇÔºåÊ®ôÊ∫ñÁöÑ swapper ÊòØ‰∏çÊúÉÈÅã‰ΩúÁöÑÔºåÂõ†ÁÇ∫ÂÖ∂‰ªñÂÖ©ÂÄã Node ÈÇÑÊúâÂ§ßÈáèÁöÑ Free Memory„ÄÇÂÅáË®≠ Node0 Ê≤íÊúâË∂≥Â§†ÁöÑË®òÊÜ∂È´îÔºåÂèØËÉΩÂú® Node0 ‰∏äÈù¢Âü∑Ë°åÁöÑ process ÊâÄ‰ΩøÁî®ÁöÑ [[anon memory]] Á≠âÁ≠âÊúÉÂú®ÂÖ∂‰ªñÁØÄÈªû‰∏äÔºåÂ¶Ç Node1„ÄÇÈÄôÊ®£ÊúÉÈÄ†ÊàêÂ≠òÂèñÂª∂ÈÅ≤„ÄÇËÄå NUMA Èö®ËëóÊôÇÈñìÊé®ÈÄ≤Ôºå‰πüÊúÉÈù¢Ëá®Âà∞Â§ßÈáèË®òÊÜ∂È´îË¢´ unmapped page cache page ÊâÄ‰ΩîÁî®ÔºåÂõ†Ê≠§Âà∞ÊúÄÂæåÂèØËÉΩÊúÉËß∏ÁôºÂÖ®ÂüüÂõûÊî∂Ôºå‰ΩÜÂÖ®ÂüüÂõûÊî∂ÊúÉÂΩ±ÈüøÊïàËÉΩ„ÄÇ</p><p>Â∞çÊñºÂ§ßÂûã NUMA Á≥ªÁµ±ÔºåÊúâÊõ¥Â§öÁöÑÁØÄÈªûÂíåÊõ¥Â§ßÁöÑË®òÊÜ∂È´îÔºåËß∏ÁôºÂÖ®ÂüüÂõûÊî∂ÁöÑÈ†ªÁéáÊúÉÊõ¥Â∞èÔºå‰ΩÜÊòØÂ§ßÂûã NUMA Á≥ªÁµ±Êõ¥Â§öÁØÄÈªûË°®Á§∫ÊúâÊõ¥Èï∑ÁöÑÂ≠òÂèñË∑ØÂæëÔºåÂ∞éËá¥Êõ¥Â§ßÁöÑ NUMA Âª∂ÈÅ≤„ÄÇÈÅéÂéªÁÇ∫‰∫ÜÂø´ÈÄüÈáãÊîæË®òÊÜ∂È´îÔºåÊúÉÁõ¥Êé•ÂÖ®ÂüüÂõûÊî∂ unmapped page cache pageÔºåÈõñÁÑ∂ÂèØ‰ª•È¶¨‰∏äÁç≤ÂæóÂ§ßÈáèÁöÑ Free MemoryÔºå‰ΩÜÊòØÂ∞çÂÖ∂‰ªñÁØÄÈªûÊúÉÈÄ†Êàê‰∏çËâØÂΩ±ÈüøÔºåÂõ†ÁÇ∫‰ªñÂÄëÂèØËÉΩÈúÄË¶ÅÈáçÊñ∞ÂæûÁ°¨Á¢üËÆÄÂèñÂâõÂâõË¢´Ê∏ÖÈô§‰∫Ü page (ÈÄôË£°ÈÄ£Êé•Âà∞ÂâõÂâõÁöÑÁ©∫ÈñìÂ±ÄÈÉ®ÊÄßÔºåÈõñÁÑ∂ÊòØÊú™Êò†Â∞ÑÔºå‰ΩÜÊòØ‰πãÂæå process ÂèØËÉΩÈÇÑÊòØÊúÉÁî®Âà∞Ë©≤ pageÔºåÊ∏õÂ∞ë I/OÔºå‰ΩÜÊòØÂõûÊî∂‰πãÂæåÈÄôÊ®£Â∞±Â§±Âéª page cache ÁöÑÊÑèÁæ©‰∫Ü )ÔºåËÄå‰∏îÂÅáË®≠Á°¨Á¢üÂè™ÊúâÈÄ£Êé•Âà∞‰∏ÄÂÄã NodeÔºåÂ∞çÊñºÂÖ∂‰ªñ Node Âæ©ÂéüÈ†ÅÈù¢ÁöÑÈñãÈä∑ÊúÉËÆäÂæóÂçÅÂàÜÁöÑÂ∑®Â§ßÔºå‰∏îÂ∞ç I/O ‰ª•ÂèäÁõ¥Êé•ÈÄ£Êé•Âà∞ I/O ÁöÑ Node Â∏∂‰æÜÈùûÂ∏∏Â§ßÁöÑË≤†Êìî„ÄÇ</p><p>Â∞çÊñº LinuxÔºåÂºïÂÖ•‰∫ÜÂçÄÂüüÂõûÊî∂Ë©¶ÂúñËß£Ê±∫‰∏äÈù¢ÈÄô‰∏Ä‰∫õÂïèÈ°å„ÄÇÁï∂ÁõÆÂâç Node Â±ÄÈÉ®Ë®òÊÜ∂È´î‰∏çË∂≥ÔºåÁ≥ªÁµ±ÊúÉÂòóË©¶ËºïÈáèÂõûÊî∂Ôºå‰πüÂ∞±ÊòØÂè™ÈáãÊîæÊú™Êò†Â∞ÑÁöÑ page cache pageÔºå‰∏çÂéªÂΩ±Èüø anon page Êàñ active page„ÄÇÂçÄÂüüÂõûÊî∂ÊúÉÂÑ™ÂÖàÂú®Êú¨Âú∞ÁöÑ Node ÂÅöÔºåÈô§ÈùûÁÑ°Ê≥ïÊªøË∂≥Ë®òÊÜ∂È´îÈúÄÊ±ÇÊôÇÔºåÊâçÊúÉËÄÉÊÖÆÂéªÂ∞çÂÖ∂‰ªñÈùûÊú¨Âú∞Ë®òÊÜ∂È´îÂÅöÊìç‰Ωú„ÄÇ</p><p>ÂõûÊî∂Êú¨Âú∞ÁöÑ page cache page ÊòØÊúâÈÅìÁêÜÁöÑÔºåpage cache page ËÄÉÊÖÆÁöÑÊòØÊé•‰∏ã‰æÜ process ÂèØËÉΩÊúÉËÄÉÊÖÆÁ©∫ÈñìÂ±ÄÈÉ®ÊÄßÁî®Âà∞Â∑Æ‰∏çÂ§öÁöÑÊ™îÊ°àÔºå‰ª•ÈÅîÂà∞Ê∏õÂ∞ë I/O ÁöÑ‰ΩúÁî®Ôºå‰ΩÜÊòØÁï∂Ë®òÊÜ∂È´î‰∏çË∂≥ÊôÇÔºåÈÄ£ process ÈÉΩÁÑ°Ê≥ïËºâÂÖ•‰∫ÜÔºåÂõ†Ê≠§ÂÑ™ÂÖàÂ∞á page cache page ÈáãÊîæÔºåÊªøË∂≥Âú®Êú¨Âú∞ËºâÂÖ• process ÁöÑÈúÄÊ±ÇÔºå‰∏îËÆì [[anon memory]] Á≠âÁ≠âÂÖßÂÆπÈÉΩÁïôÂú®Êú¨Âú∞„ÄÇ</p><p>ÈóúÊñº Linux ÁöÑÂçÄÂüüÂõûÊî∂Ê©üÂà∂ÔºåÂèØ‰ª•ÂèÉËÄÉ‰ª•‰∏ã <code>/proc/sys/vm</code></p><ul><li><code>/proc/sys/vm/zone_reclaim_mode</code>: Áî®‰æÜÊéßÂà∂ÊòØÂê¶ÂïüÁî®ÂçÄÂüüÂõûÊî∂ÔºåÂçÄÂüüÂõûÊî∂Â∞±Â¶ÇÂêå‰∏äÈù¢ÊâÄË™™ÔºåÁî®ÊñºÂòóË©¶Âú®Êú¨Âú∞ÈáãÊîæ unmapped page cache page„ÄÇÁï∂ NUMA Ë∑ùÈõ¢‰∏çÂ§ßÔºåÂ≠òÂèñÂª∂ÈÅ≤‰∏çÊòéÈ°ØÊôÇÔºåÁ≥ªÁµ±È†êË®≠ÈóúÈñâ zone_reclaim_mode„ÄÇÂ¶ÇÊûúÂª∂ÈÅ≤ËºÉÈ´òÔºåÂâáÊúÉÂïüÁî®ÔºåË®≠ÁΩÆÁÇ∫ 1</li><li><code>/proc/sys/vm/zone_reclaim_interval</code>: Áî®‰æÜÊéßÂà∂Â¶ÇÊûúÊ≤íÊúâÊàêÂäüÂõûÊî∂Êú¨Âú∞ÁöÑË®òÊÜ∂È´îÊôÇÔºåÊö´ÂÅúÈÄ≤‰∏ÄÊ≠•ÂõûÊî∂ÁöÑÊôÇÈñìÔºåÊôÇÈñìÂñÆ‰ΩçÁÇ∫ÁßíÔºå‰πüÂ∞±ÊòØÊö´ÂÅúÈÄ≤‰∏ÄÊ≠•ÊéÉÊèèÊú¨Âú∞ÁØÄÈªû‰∏≠ÂèØÂõûÊî∂ÁöÑË®òÊÜ∂È´îÔºå‰∏¶Âú®Áµ¶ÂÆöÊôÇÈñì‰πãÂæåÂÜçÁπºÁ∫åÂòóË©¶</li></ul><h3 id=ÈóúÊñº-numa-interlink-ÁöÑÈôêÂà∂>ÈóúÊñº NUMA Interlink ÁöÑÈôêÂà∂</h3><p>ÊúÄ‰∏äÈù¢Êû∂ÊßãÊàëÂÄëÂèØ‰ª•ÁúãÂà∞ NUMA Êû∂Êßã‰∏≠ÔºåÁØÄÈªû‰πãÈñìÁöÑË®òÊÜ∂È´îÂ≠òÂèñÂèØ‰ª•ÈÄöÈÅé NUMA interlink ÂÆåÊàêÔºå‰ΩÜÊòØÈÄôÂÄãÊ©üÂà∂ÊúÉÊúâ‰ª•‰∏ãÈôêÂà∂</p><ul><li>[[cacheline]] ÈôêÂà∂: ÊØèÂÄã NUMA ÁØÄÈªûÂè™ËÉΩ cache ÊúâÈôêÊï∏ÈáèÁöÑ‰æÜËá™ÊñºÂÖ∂‰ªñÁØÄÈªûÁöÑ [[cacheline]]ÔºåÂ¶ÇÊûúË∂ÖÈÅéÈÄôÂÄãÈôêÂà∂Ôºå[[cacheline]] ÊúÉË¢´È†ªÁπÅÁöÑÊõøÊèõÔºåÂ∞éËá¥ÈúÄË¶ÅÂèçË¶ÜÂæûÈÅ†Á´ØÁØÄÈªûÁç≤ÂæóË≥áÊñôÔºåÂ¢ûÂä†Â≠òÂèñÂª∂ÈÅ≤</li><li>Ë´ãÊ±ÇËôïÁêÜËÉΩÂäõÈôêÂà∂: ÊØèÂÄãÁØÄÈªûËÉΩÂ§†ËôïÁêÜË∑®ÁØÄÈªûÁöÑÈúÄÊ±ÇÊòØÊúâÈôêÁöÑÔºåÁï∂ÈúÄÊ±ÇÈÅéÂ§öÊôÇÔºåÊúÉÂ∞éËá¥Âª∂ÈÅ≤Â§ßÂπÖÂ¢ûÈï∑ÔºåËÆäÊàêÁì∂È†∏</li><li>NUMA interlink Êú¨Ë∫´È†ªÂØ¨ÊúâÈôêÔºåÁï∂Â§öÂÄã process ÂêåÊôÇÂ≠òÂèñÈÅ†Á´ØË®òÊÜ∂È´îÊôÇÔºåÂèØËÉΩÊúÉÂá∫ÁèæÁ´∂Áà≠ÔºåÈÄ≤ËÄåÊ∏õÂ∞ë‰∫ÜÊØè‰∏ÄÂÄãË´ãÊ±ÇÁöÑ thoughtputÔºåÂ¢ûÂä†Âª∂ÈÅ≤</li></ul><h3 id=cpuset-ÊéßÂà∂-page-migration-È†ÅÈù¢ÈÅ∑Áßª>CPUset ÊéßÂà∂ [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]</h3><p>cpuset Áî®ÊñºÂ∞á process ËàáÁâπÂÆöÁöÑ CPU ÂíåË®òÊÜ∂È´îÁØÄÈªûÁ∂ÅÂÆöÔºåcpuset ÂåÖÂê´Â§öÂÄãÊ™îÊ°àÔºåÂ¶Ç mems, tasks, memory_migrate, mems ÂÆöÁæ©Ë©≤ cpuset ÂèØ‰ª•Â≠òÂèñÁöÑË®òÊÜ∂È´îÁØÄÈªûÈõÜÂêà, tasks ÂàóÂá∫Ë©≤ cpuset ‰∏≠ÁöÑ process id„ÄÇÂ∞çÊñºÈÅ∑ÁßªÊï¥ÂÄãÁ®ãÂºèÁöÑ page Ê¶ÇÂøµ‰∏äÁÇ∫ÊääË©≤Á®ãÂºèÁöÑÊâÄÊúâ process ÈÉΩÂä†ÂÖ•Âà∞Âêå‰∏ÄÂÄã cpuset ‰∏≠ÔºåÊé•Ëëó‰øÆÊîπ <code>mems</code> Ê™îÊ°à‰∏≠Ë®òÊÜ∂È´îÁØÄÈªûÈõÜÂêàÔºåÂ¶ÇÊûú <code>memory_migrate</code> ÊòØÂïüÁî®ÁãÄÊÖãÔºåÂâáÈ†ÅÈù¢ÊúÉË¢´Ëá™ÂãïÈÅ∑ÁßªÂà∞Êñ∞ÂÆöÁæ©ÁöÑÁØÄÈªû„ÄÇÂ¶ÇÊûúÊòØË¶ÅÈÅ∑ÁßªÂñÆÂÄã process ÁöÑ pageÔºåÂâáÂ∞á process ÁöÑ pid ÂØ´ÂÖ•Âà∞ tasks Ê™îÊ°à‰∏≠ÔºåÂ∞áË©≤ process ÁßªÂãïÂà∞Êñ∞ÁöÑ cpuset ‰∏≠„ÄÇkernel ÊúÉËá™ÂãïÈÄ≤Ë°åÈÅ∑Áßª</p><p>Â∞çÊñº page migration Èô§‰∫Ü‰ΩøÁî® CPUset ÊéßÂà∂‰ª•Â§ñÔºå‰πüÂèØ‰ª•‰ΩøÁî® migratepages ÈÄôÂÄãÂ•ó‰ª∂ÔºåÈÄôÊòØ numa_migrate_pages syscall ÁöÑÂâçÁ´Ø„ÄÇ</p><h3 id=Êõ¥Â§öÈóúÊñº-cpuset>Êõ¥Â§öÈóúÊñº CPUset</h3><p>cpuset ÁÇ∫ cgroup ÁöÑÂ≠êÁ≥ªÁµ±ÔºåÁî®ÊñºÂ∞áÁ≥ªÁµ±‰∏≠Â§öÂÄãÁØÄÈªûÂäÉÂàÜÊàêÁØÄÈªûÈõÜÂêàÔºåÂæûËÄåÁÇ∫ÊáâÁî®Á®ãÂºèÊèê‰æõÁç®Á´ãÂü∑Ë°åÁí∞Â¢É</p><ul><li>Ë≥áÊ∫êÈöîÈõ¢: ÊØèÂÄã cpuset ÂèØ‰ª•ÈôêÂà∂ cpu ÂíåË®òÊÜ∂È´îÈôêÂà∂ÁØÑÂúçÔºåÊáâÁî®Á®ãÂºèÂú®‰∏ÄÂÄã cpuset Âü∑Ë°åÔºåÂÖ∂Ë®òÊÜ∂È´îÂàÜÈÖçÂ∞±Ë¢´ÈôêÂà∂Âú® cpuset ÊâÄÁÆ°ËΩÑÁöÑÁØÄÈªûÂÖßÔºåÈÄöÈÅéÈÄôÊ®£ÁöÑÊñπÂºèÔºåÂØ¶Áèæ process Â≠òÂèñÊú¨Âú∞Ë≥áÊ∫ê</li><li>ÊáâÁî®: ÂèØ‰ª•ÊáâÁî®ÊñºÂ§öÁØÄÈªûÁ≥ªÁµ±‰∏äÂ¶Ç NUMA ‰∏äÈù¢Âü∑Ë°åÂ§öÂÄãÂ§ßÂûãÊáâÁî®Á®ãÂºèÔºå‰∏¶Â∞çË≥áÊ∫êÁç®Á´ãÁÆ°ÁêÜ
cpuset Êèê‰æõ‰∫ÜË®òÊÜ∂È´îÂàÜÈÖçÊéßÂà∂ÁöÑÂäüËÉΩÔºåÂ¶Ç memory spreading ‰ª•Âèä [[page migration (È†ÅÈù¢ÈÅ∑Áßª)]]</li><li>memory spreading: Â¶ÇÊûúÂïüÁî®Ë®òÊÜ∂È´îÂàÜÊï£ÂäüËÉΩÔºåÂ¶Ç <code>memory_spread_page</code> ÊàñÊòØ <code>memory_spread_slab</code>ÔºåË®òÊÜ∂È´îÂàÜÈÖçÊúÉ‰ΩøÁî®È°û‰ººÊñº round robin ÁöÑÊñπÂºèÔºåÂú® cpuset ÁØÑÂúçÂÖßÁöÑÊâÄÊúâÁØÄÈªûÂàÜÈÖçË®òÊÜ∂È´î</li><li>Â¶ÇÊûúÊâÄÊúâÊáâÁî®Á®ãÂºèÈÉΩ‰ΩçÊñºÂêå‰∏ÄÂÄã cpusetÔºåÂâáÊï¥ÂÄãÊáâÁî®Á®ãÂºèÂèØ‰ª•‰ΩúÁÇ∫‰∏ÄÂÄãÂñÆ‰ΩçÈÄ≤Ë°å page migrationÔºåÂèØ‰ª•ÊáâÁî®Êñº NUMA ÁØÄÈªûË≥áÊ∫êÁöÑÁÆ°ÁêÜÔºåÊàñÊòØÂ∞çÊñºÊüê‰∫õÊáâÁî®Á®ãÂºèÁÑ°Ê≥ïÊÑüÁü• NUMAÔºåÁÑ°Ê≥ïËá™Ë°åÂÑ™ÂåñÂÖ∂Ë®òÊÜ∂È´îÂàÜÈÖçÊ®°ÂºèÔºåÂ∞±ÂèØ‰ª•‰ΩøÁî®Ê≠§ÊñπÂºèÈôç‰ΩéÂñÆ‰∏ÄÁØÄÈªûË®òÊÜ∂È´îÈÅéËºâÂïèÈ°å„ÄÇ</li></ul><p>Ëá≥ÊñºË¶Å‰∏çË¶ÅÂàÜÊï£Ë®òÊÜ∂È´îÂàÜÈÉ®ÔºåÂèØÂèÉËÄÉ‰∏äÈù¢Ë™™Âà∞ÁöÑÊáâÁî®Á®ãÂºè‰∏≠Â∏∏Ë¶ãÁöÑË≥áÊñôÊ®°ÂºèÔºåÂ¶Ç read/only, write/only Á≠âÁ≠â</p><h3 id=ÈúÄË¶ÅÈù¢Ëá®ÁöÑÂïèÈ°å>ÈúÄË¶ÅÈù¢Ëá®ÁöÑÂïèÈ°å</h3><ul><li>cpuset ÂíåÂ≠êÁ≥ªÁµ±‰∫§‰∫íÂèØËÉΩÊúâÂïèÈ°åÔºåÂ¶ÇÂ∞çÊñº slab ÂàÜÈÖçÂô®ÔºåÊúÉ‰ΩøÁî® array Á≠âÂéªÁ∂≠Ë≠∑Ëá™Â∑±Ë®òÊÜ∂È´îÁöÑ localityÔºåÁï∂ cpu ÈôêÂà∂ÂàÜÈÖçÁØÄÈªûÊôÇÔºåÂèØËÉΩÂ∞éËá¥ slab Ê≤íËæ¶Ê≥ïÊåâÁÖßÂÖ∂ÂéüÊú¨Ë®≠Ë®àÂæûÁâπÂÆöÁØÄÈªûÂàÜÈÖçË®òÊÜ∂È´î</li><li>Áï∂ slab ÈáãÊîæ cacheÔºåÂ¶Ç icache ‰ª•Âèä dentryÔºåÈÄöÂ∏∏ÈúÄË¶ÅÈáãÊîæÂ§ßÈáèÁâ©‰ª∂ÊâçËÉΩÂ§†ÂõûÊî∂Ë∂≥Â§†È†ÅÈù¢ÔºåÂÖ∑È´îÂïèÈ°åÊèèËø∞Â¶Ç‰∏ã</li></ul><p>slab ÂàÜÈÖçÂô®ÁÇ∫ kernel ‰∏≠ÂàÜÈÖçÊ©üÂà∂ÔºåÁî®ÊñºÁÆ°ÁêÜÂ∞èÂûãÔºåÈ†ªÁπÅÂàÜÈÖçÂíåÈáãÊîæÔºåÁü≠ÁîüÂëΩÈÄ±ÊúüÁöÑÁâ©‰ª∂„ÄÇ‰ªñÂ∞áË®òÊÜ∂È´îÂàÜÂâ≤ÊàêÂõ∫ÂÆöÁâ©‰ª∂Â§ßÂ∞èÁöÑ page Êàñ cacheÔºåÂ¶Ç icache, dentry„ÄÇslab ÊúÉÊ†πÊìöÊØèÂÄã page ÂÑ≤Â≠òÁöÑÁâ©‰ª∂Êï∏ÈáèÊ±∫ÂÆö‰ªÄÈ∫ºÊôÇÂÄôÈáãÊîæË®òÊÜ∂È´îÔºåÁï∂ cache page Âè™ÊúâÂ∞ëÈáèÊ≤í‰ΩøÁî®ÁöÑÁâ©‰ª∂ÊôÇÔºåÈÄôÂèØËÉΩÊúÉÈùûÂ∏∏ÁöÑ‰ΩéÊïàÔºåÂ¶Ç slab È†ÅÈù¢Êúâ 10 ÂÄãÁâ©‰ª∂ÔºåÂè™Êúâ‰∏ÄÂÄãÁâ©‰ª∂ÈÇÑÂú®‰ΩøÁî®ÔºåÂâ©‰∏ã 9 ÂÄãÈÉΩÂ∑≤Á∂ìÈáãÊîæÔºåË©≤È†ÅÈù¢ÈÇÑÊ≤íËæ¶Ê≥ïË¢´ÈáãÊîæÔºåÂ∞éËá¥ slab cache ÊúâÂ§ßÈáèÂÖßÈÉ®Á¢éË£ÇÂåñÁöÑÂïèÈ°å</p><p>Âè¶Â§ñÊòØÂõûÊî∂‰æ∑ÈôêÊÄßÔºåÂ¶ÇÊûúË®òÊÜ∂È´î‰∏çË∂≥ÊàñÊòØÂ£ìÂäõÂ§ßÔºåslab ÊúÉÂõûÊî∂ cache pageÔºå‰ΩÜÊòØÂõûÊî∂Á≠ñÁï•ÂèØËÉΩ‰∏çÂÉÖÁ∑öÂñÆ‰∏ÄÁØÄÈªûÊàñÊòØÂÖ∑È´î slab cache page„ÄÇÈÄöÂ∏∏ÂõûÊî∂ÊúÉÊòØÂÖ®ÂüüÁöÑÔºåÈÄôÂèØËÉΩÂ∞éËá¥ÂõûÊî∂Áâ©‰ª∂ÂàÜÈÖçÂú®Â§öÂÄã slab page, ËÄå‰∏çÊòØÈõÜ‰∏≠ÂõûÊî∂</p><p>Â¶ÇÊûúÂõûÊî∂ÈÅéÂ§ö slab cache ÁöÑÁâ©‰ª∂ÔºåÊòØÂê¶ÊúÉÁ†¥Â£û cache ÁöÑ localityÔºåÂΩ±ÈüøÊú™‰æÜÁöÑÊïàËÉΩ</p><p>‰∏äÈù¢ÂïèÈ°åËß£Ê±∫ÊñπÂêëÔºåÂ§ßÈÉ®ÂàÜÊúÉÂæÄÊõ¥Á¥∞Á≤íÂ∫¶ÁöÑÂõûÊî∂Á≠ñÁï•ÈÄ≤Ë°åÔºåÂ∏åÊúõÊúâ‰∏Ä‰∫õ API ËÆìÊàëÂÄëÂèØ‰ª•ÂçÄÂàÜ‰∏Ä‰∫õÊÉÖÊ≥ÅÔºåÈáùÂ∞çÊÉÖÊ≥ÅÂéªÂÑ™ÂåñÁ≠âÁ≠â</p></section><footer class=article-footer><section class=article-tags><a href=/tags/linux-kernel/>Linux Kernel</a>
<a href=/tags/linux-kernel-mm/>Linux Kernel MM</a>
<a href=/tags/numa/>NUMA</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Áõ∏ÈóúÊñáÁ´†</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/linux_pagereplacement_design/><div class=article-details><h2 class=article-title>Linux_PageReplacement_Design</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 WuTa Blog</section><section class=powerby>‰ΩøÁî® <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> Âª∫Á´ã<br>‰∏ªÈ°å <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> Áî± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> Ë®≠Ë®à</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>